<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
    <link href="https://fonts.cdnfonts.com/css/sf-pro-display" rel="stylesheet">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-title" content="Zoo Keeper">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="apple-touch-icon" sizes="180x180" href="icon.png">
    <link rel="icon" type="image/png" sizes="192x192" href="icon.png">
    <link rel="icon" type="image/png" sizes="512x512" href="icon.png">
    <meta name="theme-color" content="#0a0e1a">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>Zoo Keeper</title>
    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>
    <style>
#pauseButton {
    display: none !important;
}
/* ===================================
   REDESIGNED HOME SCREEN - MODERN & FUN
   =================================== */
/* Modal: Colorful gradient with floating effect */
.modal {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%);
    border: 3px solid rgba(255, 255, 255, 0.3);
    border-radius: 28px;
    padding: 40px 24px 32px;
    width: 90%;
    max-width: 380px;
    max-height: 90vh;
    overflow-y: auto;
    text-align: center;
    box-shadow: 0 25px 80px rgba(102, 126, 234, 0.5),
                0 15px 40px rgba(118, 75, 162, 0.3),
                inset 0 2px 4px rgba(255, 255, 255, 0.2);
    backdrop-filter: blur(20px);
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    gap: 14px;
    animation: modalBounce 0.6s cubic-bezier(0.68, -0.55, 0.265, 1.55);
}
@keyframes modalBounce {
    0% { transform: scale(0.3); opacity: 0; }
    60% { transform: scale(1.05); }
    100% { transform: scale(1); opacity: 1; }
}
/* Title: Bigger, bolder, with playful animation */
h1 {
    font-size: 56px;
    font-weight: 900;
    background: linear-gradient(135deg, #FFD700 0%, #FFF 50%, #FFD700 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    margin: 0 0 8px 0;
    letter-spacing: 1px;
    text-transform: uppercase;
    filter: drop-shadow(0 4px 12px rgba(255, 215, 0, 0.8));
    line-height: 1.1;
    animation: titleGlow 3s ease-in-out infinite;
}
@keyframes titleGlow {
    0%, 100% { filter: drop-shadow(0 4px 12px rgba(255, 215, 0, 0.8)); }
    50% { filter: drop-shadow(0 6px 20px rgba(255, 215, 0, 1)); }
}
/* Subtitle: Brighter and more inviting */
.subtitle {
    font-size: 15px;
    color: rgba(255, 255, 255, 0.95);
    margin-bottom: 16px;
    font-weight: 600;
    line-height: 1.4;
    text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
}
/* Animal Emojis: Animated carousel with bounce */
.animal-emojis {
    display: flex;
    gap: 12px;
    margin: 12px 0 18px;
    padding: 16px 12px;
    background: rgba(255, 255, 255, 0.2);
    border-radius: 20px;
    border: 2px solid rgba(255, 255, 255, 0.4);
    box-shadow: inset 0 2px 8px rgba(255, 255, 255, 0.3);
}
.animal-emojis .animal-emoji {
    font-size: 42px;
    animation: floatBounce 2s ease-in-out infinite;
    filter: drop-shadow(0 4px 8px rgba(0, 0, 0, 0.3));
}
/* Stagger the animation for each emoji */
.animal-emoji:nth-child(1) { animation-delay: 0s; }
.animal-emoji:nth-child(2) { animation-delay: 0.2s; }
.animal-emoji:nth-child(3) { animation-delay: 0.4s; }
.animal-emoji:nth-child(4) { animation-delay: 0.6s; }
.animal-emoji:nth-child(5) { animation-delay: 0.8s; }
.animal-emoji:nth-child(6) { animation-delay: 1s; }
@keyframes floatBounce {
    0%, 100% { transform: translateY(0) scale(1); }
    50% { transform: translateY(-10px) scale(1.1); }
}
/* Buttons: Modern, colorful, with hover effects */
button {
    padding: 18px 36px;
    font-size: 16px;
    margin-top: 8px;
    border-radius: 18px;
    border: none;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    cursor: pointer;
    transition: all 0.3s cubic-bezier(0.68, -0.55, 0.265, 1.55);
    box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3);
    position: relative;
    overflow: hidden;
}
button::before {
    content: '';
    position: absolute;
    top: 50%;
    left: 50%;
    width: 0;
    height: 0;
    border-radius: 50%;
    background: rgba(255, 255, 255, 0.3);
    transform: translate(-50%, -50%);
    transition: width 0.6s, height 0.6s;
}
button:active::before {
    width: 300px;
    height: 300px;
}
button:active {
    transform: scale(0.95);
}
/* Premium Start Button - Luxurious gradient */
#startBtn {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    box-shadow: 0 12px 32px rgba(102, 126, 234, 0.5);
    font-size: 18px;
    padding: 20px 40px;
    border: none;
    border-radius: 18px;
    font-weight: 800;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    position: relative;
    overflow: hidden;
}
#startBtn:hover {
    transform: translateY(-2px);
    box-shadow: 0 16px 40px rgba(102, 126, 234, 0.6);
}
#startBtn:active {
    transform: translateY(0px);
    box-shadow: 0 8px 24px rgba(102, 126, 234, 0.4);
}
/* Optional: Add a subtle shine effect */
#startBtn::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
    transition: left 0.5s;
}
#startBtn:hover::before {
    left: 100%;
}
/* Premium button - Gold gradient with sparkle effect */
#premiumBtn {
    background: linear-gradient(135deg, #FFD700 0%, #FFA500 100%);
    color: #1a1f35;
    box-shadow: 0 8px 24px rgba(255, 215, 0, 0.5);
    animation: premiumPulse 2s ease-in-out infinite;
}
@keyframes premiumPulse {
    0%, 100% { box-shadow: 0 8px 24px rgba(255, 215, 0, 0.5); }
    50% { box-shadow: 0 12px 36px rgba(255, 215, 0, 0.8); }
}
#premiumBtn:hover {
    transform: translateY(-2px) scale(1.02);
}
/* Premium status badge */
#premiumStatus {
    padding: 14px 24px;
    font-size: 16px;
    margin-top: 12px;
    border-radius: 18px;
    background: linear-gradient(135deg, #FFD700 0%, #FFA500 100%);
    color: #1a1f35;
    font-weight: 800;
    box-shadow: 0 8px 24px rgba(255, 215, 0, 0.5);
    animation: statusGlow 2s ease-in-out infinite;
}
@keyframes statusGlow {
    0%, 100% { transform: scale(1); }
    50% { transform: scale(1.03); }
}
/* Secondary buttons - Semi-transparent white */
button.secondary {
    background: rgba(255, 255, 255, 0.25);
    color: white;
    border: 2px solid rgba(255, 255, 255, 0.4);
    box-shadow: 0 8px 20px rgba(0, 0, 0, 0.2);
    margin-top: 10px;
    padding: 16px 32px;
    font-size: 15px;
}
button.secondary:hover {
    background: rgba(255, 255, 255, 0.35);
    transform: translateY(-2px);
}
/* Restore button - Smaller cyan accent */
#restoreBtn {
    background: linear-gradient(135deg, #4ECDC4 0%, #45B7D1 100%);
    color: white;
    font-size: 14px;
    padding: 12px 24px;
    box-shadow: 0 6px 16px rgba(78, 205, 196, 0.4);
}
#restoreBtn:hover {
    transform: translateY(-2px);
}
/* Firebase status: Clean and minimal */
.firebase-status {
    font-size: 12px;
    color: rgba(255, 255, 255, 0.8);
    margin: 12px 0 0;
    font-weight: 600;
    text-shadow: 0 1px 3px rgba(0, 0, 0, 0.3);
}
.firebase-status.connected {
    color: #4ade80;
}
.firebase-status.error {
    color: #f87171;
}
/* LEADERBOARD SCREEN - FULL SCREEN LIKE HOME & STATS */
#leaderboardScreen .modal {
    width: 100% !important;
    max-width: 100% !important;
    height: 100vh !important;
    max-height: 100vh !important;
    border-radius: 0 !important;
    padding: 60px 24px 44px !important;
    margin: 0 !important;
}
/* Make the list container use full width - no horizontal scroll */
.leaderboard-list {
    max-height: 70vh;
    overflow-y: auto;
    overflow-x: hidden; /* ← Force no horizontal scroll */
    margin: 15px 0;
    padding: 0 8px; /* ← Small padding to prevent edge cutoff */
    width: 100%;
    box-sizing: border-box; /* ← IMPORTANT */
}
/* WIDER LEADERBOARD ITEMS - No horizontal scroll */
.leaderboard-item {
    padding: 16px 12px; /* ← Less side padding to prevent overflow */
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    width: 100%;
    max-width: 100%;
    box-sizing: border-box; /* ← IMPORTANT: includes padding in width */
}
/* Bigger text but controlled sizing */
.leaderboard-rank {
    font-size: 24px;
    font-weight: 800;
    min-width: 45px; /* ← Controlled width */
    flex-shrink: 0; /* ← Never shrink rank */
}
.leaderboard-name {
    flex: 1;
    font-size: 18px;
    font-weight: 700;
    color: rgba(255, 255, 255, 0.9);
    margin: 0 12px;
    overflow: hidden; /* ← Prevent name overflow */
    text-overflow: ellipsis; /* ← Add ... if name is too long */
    white-space: nowrap; /* ← Keep on one line */
}
.leaderboard-score {
    font-size: 22px;
    font-weight: 800;
    color: #FFD700;
    min-width: 70px; /* ← Fixed width for score */
    flex-shrink: 0; /* ← Never shrink score */
    text-align: right;
}
/* For iPad/tablet - Keep full screen */
@media (min-width: 768px) and (orientation: portrait) {
    #leaderboardScreen .modal {
        width: 100% !important;
        max-width: 100% !important;
        height: 100vh !important;
        padding: 60px 24px 44px !important;
    }
   
    .leaderboard-list {
        max-height: 75vh;
        padding: 0 16px;
    }
}
/* Compact design styles */
@import url('https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700;800&display=swap');
body {
    font-family: 'Poppins', -apple-system, sans-serif;
    background: linear-gradient(135deg, #0a0e1a 0%, #1a1f35 100%);
    margin: 0;
    padding: 0;
    overflow: hidden;
    height: 100vh;
    display: flex;
    align-items: center;
    justify-content: center;
}
#overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(10, 14, 26, 0.97);
    backdrop-filter: blur(20px);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 1000;
    overflow: hidden; /* No scroll */
}
/* BALANCED GAME OVER SCREEN - SPREADS EVENLY, NO SCROLLING */
#gameOverScreen .modal {
    padding: 40px 24px 24px !important; /* ← More breathing room */
    gap: 12px !important; /* ← Balanced spacing */
    justify-content: center; /* ← Centers content vertically */
}
#gameOverScreen h2 {
    font-size: 32px !important; /* ← Bigger title */
    margin-bottom: 8px !important;
}
#finalScore {
    font-size: 64px !important; /* ← Bigger score */
    margin: 12px 0 !important;
    letter-spacing: -2px;
}
.badge {
    padding: 8px 20px !important;
    font-size: 15px !important;
    margin: 10px 0 12px !important;
}
#gameOverScreen .stats {
    font-size: 14px !important; /* ← Readable size */
    margin-bottom: 4px !important; /* ← Spread out a bit */
    line-height: 1.4;
}
.name-input {
    padding: 14px !important;
    margin: 14px 0 !important;
    font-size: 15px !important;
}
#gameOverScreen button {
    padding: 16px 40px !important; /* ← Nice button size */
    font-size: 15px !important;
    margin-top: 10px !important; /* ← Spread buttons */
}
.highscore-beat {
    font-size: 17px !important;
    margin: 8px 0 !important;
}
.urge-message {
    font-size: 15px !important;
    margin: 12px 0 !important;
    padding: 12px !important;
}
             .modal {
            background: transparent;
            border: none !important; /* ← REMOVES PURPLE BORDER */
            padding: 40px 20px;
            width: 90%;
            max-width: 420px;
            text-align: center;
            display: flex;
            flex-direction: column;
            gap: 16px;
        }
#overlay h1 {
    font-size: 56px;
    font-weight: 900;
    /* Use SF Pro Rounded for a friendlier, modern Apple look */
    font-family: -apple-system-ui-rounded, 'SF Pro Rounded', -apple-system, BlinkMacSystemFont, sans-serif;
    background: linear-gradient(135deg, #FFD700 0%, #FFF 50%, #FFD700 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    margin: 0 0 8px 0;
    letter-spacing: -2px; /* ← TIGHTER = more Apple-like */
    text-transform: uppercase;
    filter: drop-shadow(0 6px 16px rgba(212, 175, 55, 0.8));
    line-height: 0.9; /* ← TIGHTER line height */
}
        .subtitle {
            font-size: 14px; /* Smaller subtitle */
            color: rgba(255, 255, 255, 0.7);
            margin-bottom: 16px;
            font-weight: 500;
        }
        /* Glowing Animal Emojis Row */
        .animal-emojis {
            display: flex;
            justify-content: center;
            gap: 8px;
            flex-wrap: wrap;
            margin-bottom: 16px;
        }
        .animal-emoji {
            font-size: 32px;
            animation: glowPulse 2s infinite ease-in-out;
            text-shadow: 0 0 10px rgba(102, 126, 234, 0.5);
        }
        @keyframes glowPulse {
            0%, 100% { opacity: 0.8; transform: scale(1); }
            50% { opacity: 1; transform: scale(1.1); }
        }
        /* Buttons - Compact and sleek */
        button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 24px; /* Smaller padding */
            font-size: 16px;
            font-weight: 700;
            border-radius: 12px;
            cursor: pointer;
            box-shadow: 0 8px 24px rgba(102, 126, 234, 0.3);
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
        }
        button:hover {
            transform: translateY(-1px);
            box-shadow: 0 12px 32px rgba(102, 126, 234, 0.4);
        }
        button:active {
            transform: translateY(1px);
            box-shadow: 0 4px 16px rgba(102, 126, 234, 0.2);
        }
        button.secondary {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.1) 0%, rgba(255, 255, 255, 0.05) 100%);
            box-shadow: none;
            color: rgba(255, 255, 255, 0.9);
        }
        #premiumBtn {
            background: linear-gradient(135deg, #FFD700 0%, #FFA500 100%);
            color: #1a1f35;
            box-shadow: 0 8px 24px rgba(255, 215, 0, 0.3);
        }
        #restoreBtn {
            background: linear-gradient(135deg, #4ECDC4 0%, #45B7D1 100%);
            color: white;
            font-size: 14px;
            padding: 10px 20px;
        }
        .firebase-status {
            font-size: 12px;
            color: #4ade80;
            margin: 8px 0;
        }
        /* Responsive - Ensure compactness on all screens */
        @media (min-width: 768px) {
            .modal {
                max-width: 450px;
            }
            h1 {
                font-size: 42px;
            }
            button {
                padding: 14px 28px;
                font-size: 18px;
            }
        }
        /* Other existing game styles (keep as is for in-game) */
        @keyframes pulse {
          0%, 100% { transform: scale(1); }
          50% { transform: scale(1.02); }
        }
        .premium-item {
            border: 2px solid #FFD700 !important;
            background: rgba(255, 215, 0, 0.15) !important;
            box-shadow: 0 0 15px rgba(255, 215, 0, 0.4);
        }
        .premium-points {
            background: linear-gradient(135deg, #FFD700 0%, #FFA500 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            font-weight: 800;
        }
        /* Zone Transition Modal Styles */
        #zoneTransitionModal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(10, 14, 26, 0.92);
            backdrop-filter: blur(12px);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.4s ease;
        }
        #zoneTransitionModal.active {
            opacity: 1;
            pointer-events: auto;
        }
        .zone-modal-content {
            background: rgba(20, 25, 40, 0.98);
            border: 2px solid rgba(102, 126, 234, 0.4);
            border-radius: 28px;
            padding: 60px 40px;
            text-align: center;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.8);
            transform: scale(0.9);
            transition: transform 0.5s cubic-bezier(0.34, 1.56, 0.64, 1);
            max-width: 400px;
            width: 90%;
        }
        #zoneTransitionModal.active .zone-modal-content {
            transform: scale(1);
        }
        #zoneModalTitle {
            font-size: 48px;
            font-weight: 800;
            background: linear-gradient(135deg, #FFD700 0%, #FFA500 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 20px;
            letter-spacing: -1px;
        }
        .zone-emoji {
            font-size: 120px;
            margin: 20px 0;
            animation: zonePulse 2s ease-in-out infinite;
        }
        @keyframes zonePulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }
        .zone-subtitle {
            font-size: 20px;
            color: rgba(255, 255, 255, 0.7);
            font-weight: 600;
        }
        /* ========================================
           TABLET/IPAD OPTIMIZATION - PORTRAIT MODE ONLY
           ======================================== */
        @media (min-width: 768px) and (orientation: portrait) {
            /* DO NOT restrict gameContainer width - let it stretch full width */
            #gameContainer {
                max-width: 100%;
                width: 100%;
                margin: 0;
                border: none;
            }
        
            /* Scale up HUD elements */
            .stat-box {
                padding: 16px 24px;
                min-width: 110px;
            }
        
            .stat-label {
                font-size: 12px;
            }
        
            .stat-value {
                font-size: 40px;
            }
        
            .heart {
                width: 16px;
                height: 16px;
            }
        
            /* Larger pause button */
            #pauseButton {
                width: 64px;
                height: 64px;
                font-size: 34px;
            }
        
            /* Scale up streak bar */
            #streakBar {
                padding: 16px 20px;
            }
        
            .streak-text {
                font-size: 15px;
            }
        
            .streak-count {
                font-size: 19px;
            }
        
            .progress-bar {
                height: 11px;
            }
        
            /* Scale up difficulty indicator */
            #difficultyIndicator {
                padding: 12px 18px;
            }
        
            .difficulty-text {
                font-size: 13px;
            }
        
            .difficulty-level {
                font-size: 26px;
            }
        
            /* Larger combo */
            #combo {
                font-size: 24px;
                padding: 12px 26px;
            }
        
            /* Scale modals appropriately */
            .modal {
                max-width: 500px;
                padding: 60px 45px;
                border-radius: 28px;
                margin: 0 auto;
                height: auto;
                max-height: 90vh;
                box-shadow: 0 20px 60px rgba(0, 0, 0, 0.7),
                            inset 0 1px 0 rgba(255, 255, 255, 0.05);
            }
        
            .pause-modal {
                max-width: 450px;
                padding: 55px 45px;
            }
        
            h1 {
                font-size: 58px;
            }
        
            h2 {
                font-size: 48px;
            }
        
            .subtitle, .pause-subtitle {
                font-size: 19px;
            }
        
            button {
                padding: 24px 60px;
                font-size: 20px;
            }
        
            /* Larger animal emojis for iPad */
            .animal-item {
                padding: 18px 22px;
            }
        
            .animal-emoji {
                font-size: 40px;
            }
        
            .animal-name {
                font-size: 18px;
            }
        
            .animal-points {
                font-size: 16px;
            }
        
        }
        /* iPad-specific canvas fix - doesn't affect iPhone */
        @media (min-width: 768px) and (orientation: portrait) {
            #gameContainer {
                width: 100vw !important;
                max-width: 100vw !important;
            }
        
            canvas {
                width: 100vw !important;
                max-width: 100vw !important;
            }
        }
        /* iPad-specific fixes - PORTRAIT MODE ONLY */
        @media (min-width: 768px) and (orientation: portrait) {
            /* Full-width canvas on iPad */
            #gameContainer {
                width: 100vw !important;
                max-width: 100vw !important;
            }
        
            canvas {
                width: 100vw !important;
                max-width: 100vw !important;
            }
        
            /* Full-screen modals on iPad */
            .modal {
                width: 100% !important;
                max-width: 100% !important;
                height: 100vh !important;
                max-height: 100vh !important;
                border-radius: 0 !important;
                padding: 60px 24px 44px !important;
                margin: 0 !important;
            }
        
            .pause-modal {
                width: 100% !important;
                max-width: 100% !important;
                height: 100vh !important;
                max-height: 100vh !important;
                border-radius: 0 !important;
                padding: 60px 24px 44px !important;
                margin: 0 !important;
            }
        }
                     /* ADD THIS ENTIRE NEW CSS BLOCK */
        #gameInfoBar {
            position: absolute;
            top: 130px !important;
            left: 15px;
            right: 15px;
            display: flex; /* This makes them side-by-side */
            flex-direction: row; /* Forces horizontal layout */
            gap: 10px; /* Space between the two boxes */
            z-index: 100;
        }
                                                #hud {
                            position: absolute;
                            top: 50px !important; /* More aggressive - was 15px */
                            left: 0;
                            right: 0;
                            padding: 0 15px;
                            display: flex;
                            justify-content: space-between;
                            align-items: flex-start;
                            z-index: 100;
                        }
                                /* Pause button - top-right, matches your HUD style */
                    /* Pause button - centered between score and lives */
              
        #pauseButton {
            position: absolute;
            top: calc(10px + env(safe-area-inset-top)); /* Much closer - was 30px */
            left: 50%;
            transform: translateX(-50%);
            width: 48px;
            height: 48px;
            background: rgba(15, 20, 35, 0.9);
            border: 1px solid rgba(102, 126, 234, 0.25);
            border-radius: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 26px;
            z-index: 150;
            backdrop-filter: blur(20px);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.5);
            cursor: pointer;
            user-select: none;
            transition: all 0.2s ease;
        }
        #pauseButton:active {
            transform: translateX(-50%) scale(0.92);
        }
                    /* Pause overlay - reuses your existing modal styling */
                             #pauseOverlay {
                        position: fixed;
                        top: 0;
                        left: 0;
                        width: 100%;
                        height: 100%;
                        background: rgba(10, 14, 26, 0.85);
                        backdrop-filter: blur(12px);
                        -webkit-backdrop-filter: blur(12px);
                        display: flex;
                        align-items: center;
                        justify-content: center;
                        z-index: 1000;
                        opacity: 0;
                        pointer-events: none;
                        transition: opacity 0.3s ease;
                    }
                                    #pauseOverlay:not(.hidden) {
                            opacity: 1;
                            pointer-events: auto;
                        }
                                /* Pause modal box - centered */
        .pause-modal {
            background: rgba(20, 25, 40, 0.98);
            border: 2px solid rgba(102, 126, 234, 0.3);
            border-radius: 24px;
            padding: 40px 32px;
            width: 85%;
            max-width: 340px;
            text-align: center;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.8),
                        0 0 0 1px rgba(255, 255, 255, 0.05) inset;
            transform: scale(0.85);
            transition: transform 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
        }
        #pauseOverlay:not(.hidden) .pause-modal {
            transform: scale(1);
        }
        /* Pause icon */
        .pause-icon {
            font-size: 64px;
            margin-bottom: 16px;
            animation: pausePulse 2s ease-in-out infinite;
        }
        @keyframes pausePulse {
            0%, 100% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.1); opacity: 0.8; }
        }
        /* Pause modal text */
        .pause-modal h2 {
            font-size: 28px;
            font-weight: 800;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 12px;
        }
        .pause-subtitle {
            font-size: 14px;
            color: rgba(255, 255, 255, 0.6);
            margin-bottom: 32px;
            line-height: 1.5;
        }
        /* Pause modal buttons */
        .pause-modal button {
            margin-top: 12px;
        }
        .pause-modal button.secondary {
            background: rgba(255, 107, 107, 0.15);
            border: 1px solid rgba(255, 107, 107, 0.4);
            color: #FF6B6B;
            box-shadow: none;
        }
        .pause-modal button.secondary:active {
            background: rgba(255, 107, 107, 0.25);
        }
                                    html, body {
                        width: 100%;
                        height: 100%;
                        margin: 0;
                        padding: 0;
                        overflow: hidden;
                        background: #0a0e1a;
                    }
                                    canvas {
                        width: 100% !important;
                        height: 100% !important;
                        display: block;
                        margin: 0;
                        padding: 0;
                    }
                        #pauseOverlay:not(.hidden) .modal {
                            transform: scale(1);
                        }
                        /* Pause modal specific styles */
                        #pauseOverlay h2 {
                            font-size: 32px;
                            margin-bottom: 16px;
                        }
                        #pauseOverlay .subtitle {
                            font-size: 14px;
                            margin-bottom: 32px;
                            color: rgba(255, 255, 255, 0.6);
                        }
                        #pauseOverlay button {
                            margin-top: 12px;
                        }
                        #pauseOverlay button.secondary {
                            background: rgba(255, 107, 107, 0.2);
                            border: 1px solid rgba(255, 107, 107, 0.4);
                            color: #FF6B6B;
                        }
                        #pauseOverlay button.secondary:active {
                            background: rgba(255, 107, 107, 0.3);
                        }
                        /* Make both stat boxes vertically centered and more compact */
                                                /* Compact Stats Screen Title */
                        #statsScreen h2 {
                            font-size: 28px !important; /* ← Smaller title */
                            margin-bottom: 8px !important;
                                }
                                                   /* Make all Stats Screen text WHITE */
                        #statsScreen .stats {
                            color: #fff !important;
                        }
                        #highestLevel,
                        #favAnimal {
                            color: #fff !important;
                            font-weight: 700;
                        }
      
                .stat-box {
                    display: flex;
                    flex-direction: column;
                    justify-content: center; /* Perfect vertical centering */
                    align-items: flex-start;
                    padding: 10px 16px; /* Reduced from 12px 18px — makes boxes shorter/tighter */
                    min-width: 80px; /* Slightly smaller min-width */
                    height: 68px; /* Optional: Force exact same height on both boxes (tweak if needed) */
                }
                /* Smaller score number to better match lives box height */
                .stat-value {
                    font-size: 25px; /* Try 24px if you want it even smaller */
                    line-height: 1;
                }
                /* Fine-tune lives box alignment */
                .stat-label {
                    margin-bottom: 4px; /* Reduced from 5px */
                }
                .lives {
                    margin-top: 6px; /* Slight push down so hearts sit centered */
                    justify-content: center; /* Ensures hearts are centered if they wrap (rare) */
                }
                @import url('https://fonts.googleapis.com/css2?family=Inter:wght@600;700;800;900&display=swap');
                * {
                    margin: 0;
                    padding: 0;
                    box-sizing: border-box;
                    -webkit-tap-highlight-color: transparent;
                }
                body {
                    font-family: 'Inter', -apple-system, sans-serif;
                    background: #0a0e1a;
                    overflow: hidden;
                    height: 100vh;
                }
                   #gameContainer {
                    position: fixed; /* Changed from relative to fixed for true full-screen */
                    top: 0;
                    left: 0;
                    width: 100vw;
                    height: 100vh;
                    max-width: none; /* Critical: removes the 430px cap */
                    margin: 0;
                    padding: 0;
                    background: radial-gradient(ellipse at top, #1a1f35 0%, #0a0e1a 100%);
                    overflow: hidden; /* Prevents any scroll/overflow issues */
                }
                canvas {
                    display: block;
                    width: 100%;
                    height: 100%;
                    background: linear-gradient(180deg, #0f1729 0%, #1a2332 40%, #2d3748 100%);
                }
                #hud {
                    position: absolute;
                    top: 15px;
                    left: 0;
                    right: 0;
                    padding: 0 15px;
                    display: flex;
                    justify-content: space-between;
                    align-items: flex-start;
                    z-index: 100;
                }
                .stat-box {
                    background: rgba(15, 20, 35, 0.9);
                    border: 1px solid rgba(102, 126, 234, 0.25);
                    border-radius: 16px;
                    padding: 12px 18px;
                    min-width: 85px;
                    backdrop-filter: blur(20px);
                    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.5),
                                inset 0 1px 0 rgba(255, 255, 255, 0.05);
                    transition: all 0.3s;
                }
                .stat-box.pulse {
                    transform: scale(1.15);
                    box-shadow: 0 0 40px rgba(255, 215, 0, 0.8);
                    animation: pulseGlow 0.5s ease-out;
                }
                @keyframes pulseGlow {
                    0%, 100% { box-shadow: 0 0 40px rgba(255, 215, 0, 0.8); }
                    50% { box-shadow: 0 0 60px rgba(255, 215, 0, 1); }
                }
                .stat-label {
                    font-size: 9px;
                    color: rgba(255, 255, 255, 0.5);
                    text-transform: uppercase;
                    letter-spacing: 1.2px;
                    margin-bottom: 5px;
                    font-weight: 600;
                }
                .stat-value {
                    font-size: 30px;
                    font-weight: 800;
                    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                    -webkit-background-clip: text;
                    -webkit-text-fill-color: transparent;
                    background-clip: text;
                    line-height: 1;
                }
                .lives {
                    display: flex;
                    gap: 6px;
                    margin-top: 5px;
                    flex-wrap: wrap;
                }
                .heart {
                    width: 10px;
                    height: 10px;
                    border-radius: 50%;
                    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                    box-shadow: 0 0 12px rgba(102, 126, 234, 0.7);
                    transition: all 0.3s;
                }
                .heart.lost {
                    background: rgba(255, 255, 255, 0.1);
                    box-shadow: none;
                }
                .heart.gained {
                    animation: heartPop 0.5s ease-out;
                }
                @keyframes heartPop {
                    0% { transform: scale(0); }
                    50% { transform: scale(1.3); }
                    100% { transform: scale(1); }
                }
                #streakBar {
            position: relative; /* CHANGED: was "absolute" */
            flex: 1; /* NEW LINE: add this */
            background: rgba(15, 20, 35, 0.9);
            border: 1px solid rgba(255, 215, 0, 0.4);
            border-radius: 12px;
            padding: 10px 14px;
            backdrop-filter: blur(20px);
            transition: all 0.3s;
        }
                #streakBar.hot {
                    border-color: rgba(255, 215, 0, 0.8);
                    box-shadow: 0 0 30px rgba(255, 215, 0, 0.5);
                }
                .streak-info {
                    display: flex;
                    justify-content: space-between;
                    align-items: center;
                    margin-bottom: 6px;
                }
                .streak-text {
                    font-size: 11px;
                    font-weight: 700;
                    color: #FFD700;
                    text-transform: uppercase;
                    letter-spacing: 0.8px;
                }
                .streak-count {
                    font-size: 13px;
                    font-weight: 800;
                    color: #fff;
                }
                .progress-bar {
                    height: 7px;
                    background: rgba(255, 255, 255, 0.1);
                    border-radius: 4px;
                    overflow: hidden;
                    position: relative;
                }
                .progress-fill {
                    height: 100%;
                    background: linear-gradient(90deg, #FFD700 0%, #FFA500 100%);
                    width: 0%;
                    transition: width 0.3s;
                    box-shadow: 0 0 10px rgba(255, 215, 0, 0.5);
                }
                .streak-reward {
                    font-size: 9px;
                    color: rgba(255, 255, 255, 0.6);
                    text-align: center;
                    margin-top: 4px;
                    font-weight: 600;
                }
                    #difficultyIndicator {
                    position: relative; /* CHANGED: was "absolute" */
                    flex: 1; /* NEW LINE: add this */
                    background: rgba(15, 20, 35, 0.9);
                    border: 1px solid rgba(255, 107, 107, 0.3);
                    border-radius: 12px;
                    padding: 8px 12px;
                    backdrop-filter: blur(20px);
                    text-align: center;
                }
                .difficulty-text {
                    font-size: 9px;
                    font-weight: 700;
                    color: rgba(255, 255, 255, 0.7);
                    text-transform: uppercase;
                    letter-spacing: 1px;
                }
                .difficulty-level {
                    font-size: 16px;
                    font-weight: 800;
                    margin-top: 3px;
                }
                .diff-beginner { color: #4ade80; }
                .diff-easy { color: #86efac; }
                .diff-medium { color: #fbbf24; }
                .diff-challenging { color: #fb923c; }
                .diff-hard { color: #f87171; }
                .diff-expert { color: #dc2626; }
                #overlay {
                    position: fixed;
                    top: 0;
                    left: 0;
                    width: 100%;
                    height: 100%;
                    background: rgba(10, 14, 26, 0.97);
                    backdrop-filter: blur(20px);
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    z-index: 1000;
                }
          
        .modal {
            background: rgba(20, 25, 40, 0.95);
            border: 1px solid rgba(102, 126, 234, 0.2);
            border-radius: 0; /* Remove rounded corners for full screen */
            padding: 60px 24px 44px; /* Add more top padding for status bar */
            width: 100%; /* Full width */
            height: 100vh; /* Full viewport height */
            max-width: 100%; /* Override the 370px limit */
            max-height: 100vh; /* Full height */
            margin: 0; /* Remove auto margins */
            text-align: center;
            box-shadow: none; /* Remove shadow for cleaner full-screen look */
            overflow-y: auto;
            display: flex;
            flex-direction: column;
        }
        /* Optional: Add safe area padding for iPhone notch */
        @supports (padding: env(safe-area-inset-top)) {
            #hud {
                top: calc(5px + env(safe-area-inset-top));
                padding: 0 15px;
            }
            #gameInfoBar {
                top: calc(80px + env(safe-area-inset-top)); /* NEW: adjust the wrapper, not the children */
            }
            #combo {
        top: calc(210px + env(safe-area-inset-top)) !important; /* ← CHANGE 155 to 210 */
            }
        }
        /* If you want to keep the rounded modal on larger screens: */
        @media (min-width: 768px) {
            .modal {
                border-radius: 28px;
                padding: 44px 36px;
                max-width: 90%;
                width: 370px;
                height: auto;
                max-height: 90vh;
                margin: 0 auto;
                box-shadow: 0 20px 60px rgba(0, 0, 0, 0.7),
                            inset 0 1px 0 rgba(255, 255, 255, 0.05);
            }
        }
                h1 {
                    font-size: 44px;
                    font-weight: 800;
                    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                    -webkit-background-clip: text;
                    -webkit-text-fill-color: transparent;
                    background-clip: text;
                    margin-bottom: 8px;
                    letter-spacing: -1px;
                }
                h2 {
                    font-size: 36px;
                    font-weight: 800;
                    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                    -webkit-background-clip: text;
                    -webkit-text-fill-color: transparent;
                    background-clip: text;
                    margin-bottom: 12px;
                    letter-spacing: -1px;
                }
                .subtitle {
                    font-size: 15px;
                    color: rgba(255, 255, 255, 0.6);
                    margin-bottom: 28px;
                    font-weight: 600;
                }
                .animal-list {
                    margin: 24px 0;
                    background: rgba(255, 255, 255, 0.02);
                    border-radius: 20px;
                    padding: 8px;
                    border: 1px solid rgba(255, 255, 255, 0.05);
                    max-height: 60vh;
                    overflow-y: auto;
                }
                .animal-item {
                    display: flex;
                    justify-content: space-between;
                    align-items: center;
                    padding: 12px 16px;
                    margin: 5px 0;
                    background: rgba(255, 255, 255, 0.04);
                    border-radius: 14px;
                    border: 1px solid rgba(255, 255, 255, 0.06);
                }
                .animal-left {
                    display: flex;
                    align-items: center;
                    gap: 12px;
                }
                .animal-emoji {
                    font-size: 28px;
                }
                .animal-name {
                    font-size: 14px;
                    color: rgba(255, 255, 255, 0.95);
                    font-weight: 700;
                }
                .animal-points {
                    font-size: 13px;
                    font-weight: 700;
                    background: linear-gradient(135deg, #FFD700 0%, #FFA500 100%);
                    -webkit-background-clip: text;
                    -webkit-text-fill-color: transparent;
                    background-clip: text;
                    padding: 5px 12px;
                    background-color: rgba(255, 215, 0, 0.1);
                    border-radius: 10px;
                    border: 1px solid rgba(255, 215, 0, 0.2);
                }
                button {
                    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                    color: white;
                    border: none;
                    padding: 18px 44px;
                    font-size: 16px;
                    font-weight: 700;
                    border-radius: 16px;
                    cursor: pointer;
                    margin-top: 24px;
                    width: 100%;
                    box-shadow: 0 12px 32px rgba(102, 126, 234, 0.4);
                    font-family: 'Inter', sans-serif;
                    text-transform: uppercase;
                    letter-spacing: 1px;
                    transition: all 0.2s;
                }
                button:active {
                    transform: translateY(2px);
                    box-shadow: 0 8px 24px rgba(102, 126, 234, 0.3);
                }
                button.secondary {
                    background: rgba(255, 255, 255, 0.1);
                    box-shadow: none;
                    margin-top: 10px;
                }
                .instruction {
                    font-size: 13px;
                    color: rgba(255, 255, 255, 0.5);
                    margin-top: 18px;
                    font-weight: 600;
                }
                          #finalScore {
                    font-size: 56px !important; /* ← Smaller (was 80px) */
                    font-weight: 800;
                    background: linear-gradient(135deg, #FFD700 0%, #FFA500 100%);
                    -webkit-background-clip: text;
                    -webkit-text-fill-color: transparent;
                    background-clip: text;
                    margin: 12px 0 !important; /* ← Less space */
                    line-height: 1;
                    letter-spacing: -2px;
                }
                               .badge {
                    display: inline-block;
                    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                    color: white;
                    padding: 8px 20px; /* ← Smaller */
                    border-radius: 10px;
                    font-size: 14px; /* ← Smaller */
                    font-weight: 700;
                    margin: 8px 0 12px !important; /* ← Less space */
                    box-shadow: 0 6px 20px rgba(102, 126, 234, 0.3);
                }
                                .stats {
                    font-size: 13px;
                    color: #fff !important; /* ← WHITE */
                    margin-bottom: 3px; /* ← Compact */
                    font-weight: 600;
                    line-height: 1.3;
                }
                .highscore-beat {
                    font-size: 18px;
                    font-weight: 800;
                    color: #FFD700;
                    margin: 10px 0;
                    animation: glow 1s infinite;
                }
                @keyframes glow {
                    0%, 100% { text-shadow: 0 0 10px rgba(255, 215, 0, 0.5); }
                    50% { text-shadow: 0 0 20px rgba(255, 215, 0, 0.8); }
                }
                .urge-message {
                    font-size: 16px;
                    font-weight: 700;
                    color: #FF6B6B;
                    margin: 15px 0;
                    padding: 12px;
                    background: rgba(255, 107, 107, 0.1);
                    border: 2px solid #FF6B6B;
                    border-radius: 12px;
                    animation: pulse 1.5s infinite;
                }
                @keyframes pulse {
                    0%, 100% { transform: scale(1); }
                    50% { transform: scale(1.03); }
                }
                   #combo {
                    position: absolute;
                    top: 155px; /* CHANGED: was "215px" - moved up 60px */
                    left: 50%;
                    transform: translateX(-50%) scale(0.8);
                    background: linear-gradient(135deg, #FFD700 0%, #FFA500 100%);
                    color: white;
                    padding: 8px 18px;
                    border-radius: 10px;
                    font-size: 16px;
                    font-weight: 800;
                    opacity: 0;
                    transition: all 0.3s;
                    z-index: 99;
                    box-shadow: 0 8px 24px rgba(255, 215, 0, 0.4);
                }
                #combo.show {
                    opacity: 1;
                    transform: translateX(-50%) scale(1);
                }
                .achievement {
                    position: fixed;
                    top: 15px;
                    right: 15px;
                    transform: translateX(350px);
                    background: rgba(20, 25, 40, 0.98);
                    border: 2px solid #FFD700;
                    border-radius: 14px;
                    padding: 12px 18px;
                    text-align: left;
                    z-index: 2000;
                    box-shadow: 0 12px 40px rgba(255, 215, 0, 0.6);
                    transition: all 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55);
                    opacity: 0;
                    max-width: 250px;
                    display: flex;
                    align-items: center;
                    gap: 12px;
                }
                .achievement.show {
                    opacity: 1;
                    transform: translateX(0);
                }
                .achievement-icon {
                    font-size: 32px;
                    flex-shrink: 0;
                    animation: bounce 0.6s ease-out;
                }
                @keyframes bounce {
                    0%, 100% { transform: translateY(0); }
                    25% { transform: translateY(-10px); }
                    50% { transform: translateY(0); }
                    75% { transform: translateY(-5px); }
                }
                .achievement-content {
                    flex: 1;
                }
                .achievement-text {
                    font-size: 14px;
                    font-weight: 800;
                    color: #FFD700;
                    margin-bottom: 2px;
                }
                .achievement-desc {
                    font-size: 11px;
                    color: rgba(255, 255, 255, 0.7);
                }
                .big-win {
                    position: fixed;
                    top: 50%;
                    left: 50%;
                    transform: translate(-50%, -50%) scale(0);
                    font-size: 60px;
                    font-weight: 900;
                    color: #FFD700;
                    text-shadow: 0 0 40px rgba(255, 215, 0, 1);
                    z-index: 3000;
                    opacity: 0;
                    pointer-events: none;
                    animation: bigWinPop 2s ease-out;
                }
                @keyframes bigWinPop {
                    0% { transform: translate(-50%, -50%) scale(0); opacity: 0; }
                    10% { transform: translate(-50%, -50%) scale(1.5); opacity: 1; }
                    90% { transform: translate(-50%, -50%) scale(1.2); opacity: 1; }
                    100% { transform: translate(-50%, -50%) scale(0); opacity: 0; }
                }
                .slowmo-overlay {
                    position: fixed;
                    top: 0;
                    left: 0;
                    width: 100%;
                    height: 100%;
                    background: rgba(0, 255, 255, 0.15);
                    pointer-events: none;
                    z-index: 1500;
                    opacity: 0;
                    transition: opacity 0.5s;
                }
                .slowmo-overlay.active {
                    opacity: 1;
                    animation: slowmoPulse 1s infinite;
                }
                @keyframes slowmoPulse {
                    0%, 100% { background: rgba(0, 255, 255, 0.1); }
                    50% { background: rgba(0, 255, 255, 0.2); }
                }
                .game-over-animation {
                    position: fixed;
                    top: 0;
                    left: 0;
                    width: 100%;
                    height: 100%;
                    background: radial-gradient(circle, rgba(102, 126, 234, 0.2) 0%, rgba(10, 14, 26, 0.95) 70%);
                    z-index: 999;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    animation: fadeIn 0.8s ease-out;
                }
                @keyframes fadeIn {
                    from { opacity: 0; }
                    to { opacity: 1; }
                }
                .game-over-text {
                    font-size: 64px;
                    font-weight: 900;
                    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                    -webkit-background-clip: text;
                    -webkit-text-fill-color: transparent;
                    animation: slideDown 0.8s ease-out;
                    text-align: center;
                    padding: 0 20px;
                    width: 100%;
                    max-width: 90vw;
                    word-wrap: break-word;
                }
                @keyframes slideDown {
                    from { transform: translateY(-100px); opacity: 0; }
                    to { transform: translateY(0); opacity: 1; }
                }
                .stats-grid {
                    display: grid;
                    grid-template-columns: 1fr 1fr;
                    gap: 8px; /* ← Reduced from 15px */
                    margin: 12px 0; /* ← Reduced from 20px */
                }
                              .stat-card {
                    background: rgba(255, 255, 255, 0.05);
                    border: 1px solid rgba(255, 255, 255, 0.1);
                    border-radius: 12px; /* ← Bigger radius */
                    padding: 16px 12px; /* ← Much more padding */
                    text-align: center;
                }
          
                    .stat-card-value {
                        font-size: 32px; /* ← Bigger numbers */
                        font-weight: 800;
                        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                        -webkit-background-clip: text;
                        -webkit-text-fill-color: transparent;
                        margin-bottom: 4px; /* ← More space */
                        line-height: 1;
                    }
                                  .stat-card-label {
                        font-size: 11px; /* ← Bigger labels */
                        color: rgba(255, 255, 255, 0.5);
                        text-transform: uppercase;
                        letter-spacing: 0.8px;
                    }
                .leaderboard-list {
                    margin: 20px 0;
                    max-height: 50vh;
                    overflow-y: auto;
                }
                .leaderboard-item {
                    display: flex;
                    justify-content: space-between;
                    align-items: center;
                    padding: 12px 16px;
                    margin: 8px 0;
                    background: rgba(255, 255, 255, 0.04);
                    border-radius: 12px;
                    border: 1px solid rgba(255, 255, 255, 0.06);
                    transition: all 0.3s;
                }
                .leaderboard-item:hover {
                    background: rgba(255, 255, 255, 0.08);
                    transform: translateX(4px);
                }
                .leaderboard-item.top1 {
                    background: linear-gradient(135deg, rgba(255, 215, 0, 0.2) 0%, rgba(255, 215, 0, 0.05) 100%);
                    border-color: #FFD700;
                }
                .leaderboard-item.top2 {
                    background: linear-gradient(135deg, rgba(192, 192, 192, 0.2) 0%, rgba(192, 192, 192, 0.05) 100%);
                    border-color: #C0C0C0;
                }
                .leaderboard-item.top3 {
                    background: linear-gradient(135deg, rgba(205, 127, 50, 0.2) 0%, rgba(205, 127, 50, 0.05) 100%);
                    border-color: #CD7F32;
                }
                .leaderboard-rank {
                    font-size: 20px;
                    font-weight: 800;
                    min-width: 40px;
                    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                    -webkit-background-clip: text;
                    -webkit-text-fill-color: transparent;
                }
                .top1 .leaderboard-rank {
                    background: linear-gradient(135deg, #FFD700 0%, #FFA500 100%);
                    -webkit-background-clip: text;
                    -webkit-text-fill-color: transparent;
                }
                .leaderboard-name {
                    flex: 1;
                    font-size: 16px;
                    font-weight: 700;
                    color: rgba(255, 255, 255, 0.9);
                    margin: 0 12px;
                }
                .leaderboard-score {
                    font-size: 18px;
                    font-weight: 800;
                    color: #FFD700;
                }
                .name-input {
                    width: 100%;
                    padding: 16px;
                    margin: 16px 0;
                    background: rgba(255, 255, 255, 0.05);
                    border: 2px solid rgba(102, 126, 234, 0.3);
                    border-radius: 12px;
                    color: white;
                    font-size: 16px;
                    font-weight: 600;
                    font-family: 'Inter', sans-serif;
                    text-align: center;
                    transition: all 0.3s;
                }
                .name-input:focus {
                    outline: none;
                    border-color: rgba(102, 126, 234, 0.8);
                    background: rgba(255, 255, 255, 0.08);
                }
                .name-input::placeholder {
                    color: rgba(255, 255, 255, 0.3);
                }
                .loading {
                    color: rgba(255, 255, 255, 0.5);
                    font-size: 14px;
                    margin: 20px 0;
                }
                .hidden {
                    opacity: 0;
                    pointer-events: none;
                    visibility: hidden;
                }
                .firebase-status {
                    font-size: 11px;
                    color: rgba(255, 255, 255, 0.4);
                    margin-top: 10px;
                }
                .firebase-status.connected {
                    color: #4ade80;
                }
                .firebase-status.error {
                    color: #f87171;
                }
        /* Portrait-only lock - MOBILE + TABLET */
        @media (orientation: landscape) {
            body::before {
                content: "📱 Portrait Mode Only";
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: #0a0e1a;
                color: white;
                display: flex;
                flex-direction: column;
                align-items: center;
                justify-content: center;
                font-size: 32px;
                font-weight: 700;
                font-family: 'Inter', sans-serif;
                z-index: 10000;
                text-align: center;
                padding: 20px;
                gap: 0px;
                line-height: 1.4;
            }
        
            body::after {
                content: "";
                display: none;
            }
        
            /* Hide game content in landscape */
            #gameContainer,
            #overlay,
            .modal {
                opacity: 0.1;
                pointer-events: none;
            }
        }
        /* Force hide rotation prompt in portrait */
        @media (orientation: portrait) {
            body::before,
            body::after {
                display: none !important;
            }
        }
        @keyframes rotateIcon {
            0%, 100% { transform: rotate(0deg); }
            50% { transform: rotate(90deg); }
        }
        /* iPad Portrait Optimization */
        @media (min-width: 768px) and (max-width: 1024px) and (orientation: portrait) {
            /* Center game with max playable width */
            #gameContainer {
                max-width: 600px;
                margin: 0 auto;
                border-left: 1px solid rgba(102, 126, 234, 0.2);
                border-right: 1px solid rgba(102, 126, 234, 0.2);
            }
        
            /* Scale up HUD elements */
            .stat-box {
                padding: 14px 22px;
                min-width: 100px;
            }
        
            .stat-label {
                font-size: 11px;
            }
        
            .stat-value {
                font-size: 36px;
            }
        
            .heart {
                width: 14px;
                height: 14px;
            }
        
            /* Larger pause button */
            #pauseButton {
                width: 56px;
                height: 56px;
                font-size: 30px;
            }
        
            /* Scale up streak bar */
            #streakBar {
                padding: 14px 18px;
            }
        
            .streak-text {
                font-size: 13px;
            }
        
            .streak-count {
                font-size: 16px;
            }
        
            .progress-bar {
                height: 9px;
            }
        
            /* Scale up difficulty indicator */
            #difficultyIndicator {
                padding: 10px 16px;
            }
        
            .difficulty-text {
                font-size: 11px;
            }
        
            .difficulty-level {
                font-size: 20px;
            }
        
            /* Larger combo */
            #combo {
                font-size: 20px;
                padding: 10px 22px;
            }
        
            /* Scale modals appropriately */
            .modal {
                max-width: 450px;
                padding: 50px 40px;
            }
        
            .pause-modal {
                max-width: 400px;
                padding: 50px 40px;
            }
        
            h1 {
                font-size: 52px;
            }
        
            h2 {
                font-size: 42px;
            }
        
            .subtitle, .pause-subtitle {
                font-size: 17px;
            }
        
            button {
                padding: 20px 50px;
                font-size: 18px;
            }
        }
        @keyframes rotateIcon {
            0%, 100% { transform: translateX(-50%) rotate(0deg); }
            50% { transform: translateX(-50%) rotate(90deg); }
        }
        @supports (padding: env(safe-area-inset-top)) {
            #hud {
                top: calc(25px + env(safe-area-inset-top));
                padding: 0 15px;
            }
            #gameInfoBar {
                top: calc(100px + env(safe-area-inset-top));
            }
            #combo {
                top: calc(175px + env(safe-area-inset-top));
            }
        }
        /* Fallback for older iOS (constant instead of env) */
        @supports (padding: constant(safe-area-inset-top)) {
            #hud {
                top: calc(25px + constant(safe-area-inset-top));
            }
            #gameInfoBar {
                top: calc(100px + constant(safe-area-inset-top));
            }
            #combo {
                top: calc(175px + constant(safe-area-inset-top));
            }
        }
        /* Portrait Pause Lock */
        .portrait-pause::before {
            content: "📱 Portrait Mode Only";
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: linear-gradient(45deg, #0a0e1a, #1a1e3a);
            color: #fff;
            font-size: 28px;
            font-weight: bold;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 9999;
            text-align: center;
            animation: glow 2s infinite;
        }
        .portrait-pause canvas {
            opacity: 0.3;
        }
        @keyframes glow {
            0%, 100% { text-shadow: 0 0 20px #00ffff; }
            50% { text-shadow: 0 0 40px #00ffff; }
        }
            
            /* ADD NEW CELEBRATION & ZONE CSS HERE */
            /* Confetti particles */
        .confetti {
            position: fixed;
            width: 10px;
            height: 10px;
            background: #FFD700;
            top: 0;
            z-index: 5000;
            pointer-events: none;
            animation: confettiFall 2s ease-out forwards;
        }
        @keyframes confettiFall {
            0% {
                transform: translateY(0) rotate(0deg);
                opacity: 1;
            }
            100% {
                transform: translateY(100vh) rotate(720deg);
                opacity: 0;
            }
        }
        /* Screen shake */
        @keyframes screenShake {
            0%, 100% { transform: translate(0, 0); }
            10%, 30%, 50%, 70%, 90% { transform: translate(-5px, 0); }
            20%, 40%, 60%, 80% { transform: translate(5px, 0); }
        }
        .shake {
            animation: screenShake 0.5s ease-in-out;
        }
        /* Fireworks */
        .firework {
            position: fixed;
            width: 4px;
            height: 4px;
            border-radius: 50%;
            z-index: 5000;
            pointer-events: none;
        }
        @keyframes fireworkBurst {
            0% {
                opacity: 1;
                transform: translate(0, 0) scale(1);
            }
            100% {
                opacity: 0;
                transform: translate(var(--tx), var(--ty)) scale(0);
            }
        }
        /* Zone popup */
        @keyframes zonePopup {
            0% { transform: translate(-50%, -50%) scale(0); opacity: 0; }
            10% { transform: translate(-50%, -50%) scale(1.2); opacity: 1; }
            85% { transform: translate(-50%, -50%) scale(1); opacity: 1; }
            100% { transform: translate(-50%, -50%) scale(0.8); opacity: 0; }
        }
        /* Combo message */
        @keyframes comboPop {
            0% { transform: translate(-50%, 0) scale(0); opacity: 0; }
            15% { transform: translate(-50%, 0) scale(1.3); opacity: 1; }
            80% { transform: translate(-50%, 0) scale(1); opacity: 1; }
            100% { transform: translate(-50%, -20px) scale(0.8); opacity: 0; }
        }
#gameOverScreen, #statsScreen, #leaderboardScreen {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  z-index: 1000;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: opacity 0.3s ease;
}
    </style>
</head>
<body>
    <div id="gameContainer">
        <div id="hud">
            <div class="stat-box" id="scoreBox">
                <div class="stat-label">Score</div>
                <div class="stat-value" id="scoreDisplay">0</div>
            </div>
            <div class="stat-box">
                <div class="stat-label">Lives</div>
                <div class="lives" id="livesDisplay">
                    <div class="heart"></div>
                    <div class="heart"></div>
                    <div class="heart"></div>
                    <div class="heart"></div>
                    <div class="heart"></div>
                </div>
            </div>
        </div>
        <div id="gameInfoBar">
            <div id="streakBar">
                <div class="streak-info">
                    <span class="streak-text">🔥 STREAK</span>
                    <span class="streak-count" id="streakCount">0/10</span>
                </div>
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill"></div>
                </div>
                <div class="streak-reward" id="streakReward">Next: +1 Life! ❤️</div>
            </div>
            <div id="difficultyIndicator">
                <div class="difficulty-text">Level</div>
                <div class="difficulty-level" id="diffLevel">1</div>
            </div>
        </div>
        <div id="combo"></div>
        <canvas id="gameCanvas"></canvas>
        <div id="pauseButton">⏸️</div>
        <!-- Full-screen pause overlay -->
        <div id="pauseOverlay" class="hidden">
            <div class="pause-modal">
                <div class="pause-icon">⏸️</div>
                <h2>Game Paused</h2>
                <p class="pause-subtitle">Take a break! Tap Resume to continue playing.</p>
                <button id="resumeButton">Resume Game</button>
                <button class="secondary" id="quitButton">Quit to Menu</button>
            </div>
        </div>
    </div>
    <div class="slowmo-overlay" id="slowmoOverlay"></div>
    <div id="overlay">
        <div class="modal">
            <h1>Zoo Keeper</h1>
            <p class="subtitle">Catch animals to build your zoo! Unlock premiums for epic rewards.</p>
            <!-- Glowing Animal Emojis Row -->
            <div class="animal-emojis">
                <span class="animal-emoji">🦄</span>
                <span class="animal-emoji">🐉</span>
                <span class="animal-emoji">🐳</span>
                <span class="animal-emoji">🦇</span>
                <span class="animal-emoji">🦜</span>
                <span class="animal-emoji">🐒</span>
            </div>
            <p class="firebase-status" id="firebaseStatus">Connecting to leaderboard...</p>
            <button id="startBtn"><span>🎮</span> Start Playing</button>
            <button id="premiumBtn" onclick="buyPremiumAnimals()">💎 Unlock Premiums</button>
                        <div id="premiumStatus" class="hidden" style="
                background: linear-gradient(135deg, #FFD700 0%, #FFA500 100%);
                color: #1a1f35;
                padding: 12px 24px;
                border-radius: 12px;
                font-size: 15px;
                font-weight: 700;
                box-shadow: 0 8px 24px rgba(255, 215, 0, 0.3);
                display: flex;
                align-items: center;
                justify-content: center;
                gap: 8px;
                margin-top: 24px;
                width: 100%;
            ">
                <span style="font-size: 20px;">💎</span>
                Premium Active
            </div>
            <button class="secondary" id="statsBtn"><span>📊</span> View Stats</button>
            <button class="secondary" id="leaderboardBtn"><span>🏆</span> Leaderboard</button>
            <button id="restoreBtn" onclick="restorePurchases()">🔄 Restore Purchases</button>
        </div>
    </div>
    <div id="gameOverScreen" class="hidden">
        <div id="overlay">
            <div class="modal">
                <h2 id="gameOverTitle">Amazing Run!</h2>
                <div id="finalScore">0</div>
                <div id="newHighScore" class="highscore-beat hidden">🏆 NEW HIGH SCORE! 🏆</div>
                <div id="urgePlayAgain" class="urge-message hidden"></div>
                <div class="badge" id="badge">Great Job!</div>
                <p class="stats" id="stats">0 animals rescued</p>
                <p class="stats" id="streakStats">Best Streak: 0</p>
                <p class="stats" id="diffStats">Reached Level: 1</p>
                <p class="stats" id="premiumStats">⭐ Premium: 0 (0/14 species)</p>
                <p class="stats" id="almostMsg" style="color: #FFD700;"></p>
                <input type="text" id="playerNameInput" class="name-input" placeholder="Enter your name" maxlength="20" />
                <button id="submitScoreBtn">🏆 Submit to Leaderboard</button>
                <button id="restartBtn">Play Again 🎮</button>
                <button class="secondary" id="viewStatsBtn">View Full Stats 📊</button>
            </div>
        </div>
    </div>
    <div id="statsScreen" class="hidden">
        <div id="overlay">
            <div class="modal">
                <h2>📊 Player Stats</h2>
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-card-value" id="totalGames">0</div>
                        <div class="stat-card-label">Games Played</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-card-value" id="totalAnimals">0</div>
                        <div class="stat-card-label">Total Caught</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-card-value" id="totalPoints">0</div>
                        <div class="stat-card-label">Total Points</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-card-value" id="bestScore">0</div>
                        <div class="stat-card-label">High Score</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-card-value" id="longestStreak">0</div>
                        <div class="stat-card-label">Best Streak</div>
                    </div>
                   <div class="stat-card">
                    <div class="stat-card-value" id="totalPremiums">0</div>
                    <div class="stat-card-label">⭐ Total Caught</div>
                </div>
                <div class="stat-card">
                    <div class="stat-card-value" id="premiumCollection">0/14</div>
                    <div class="stat-card-label">Species Found</div>
                </div>
                <div class="stat-card">
    <div class="stat-card-value" id="highestZone">Training Grounds</div>
    <div class="stat-card-label">Farthest Zone</div>
  </div>
                                    </div>
                <p class="stats" style="margin-top: 20px;">🏆 Highest Level: <span id="highestLevel">1</span></p>
                <p class="stats">⭐ Favorite Animal: <span id="favAnimal">🐇 Rabbit</span></p>
                <p class="stats" style="margin-top: 15px; color: rgba(255,255,255,0.4); font-size: 12px;">Keep playing to improve your stats!</p>
                <button id="closeStatsBtn">Back to Menu</button>
            </div>
        </div>
    </div>
    <div id="leaderboardScreen" class="hidden">
        <div id="overlay">
            <div class="modal">
                <h2>🏆 Global Leaderboard</h2>
                <p class="subtitle">Top Players Worldwide</p>
                <div id="leaderboardList" class="leaderboard-list">
                    <p class="loading">Loading leaderboard...</p>
                </div>
                <button id="closeLeaderboardBtn">Back to Menu</button>
            </div>
        </div>
    </div>
    <div id="achievementPopup" class="achievement">
        <div class="achievement-icon" id="achIcon">🏆</div>
        <div class="achievement-content">
            <div class="achievement-text" id="achText">Achievement!</div>
            <div class="achievement-desc" id="achDesc">You did it!</div>
        </div>
    </div>
   <script>
       window.addEventListener('DOMContentLoaded', () => {
    premiumUnlocked = localStorage.getItem('premiumUnlocked') === 'true';
    updatePremiumButton();
});
        //localStorage.setItem('premiumUnlocked', 'true');
        //window.addEventListener('DOMContentLoaded', () => {
            //premiumUnlocked = true;
            //updatePremiumButton(); // ✅ Now safe!
        const firebaseConfig = {
            apiKey: "AIzaSyDWLgSdmM1E3Mq0_oVQK3H6UfvJWv0A8HM",
            authDomain: "zookeeper-b75c4.firebaseapp.com",
            databaseURL: "https://zookeeper-b75c4-default-rtdb.firebaseio.com",
            projectId: "zookeeper-b75c4",
            storageBucket: "zookeeper-b75c4.firebasestorage.app",
            messagingSenderId: "424082143710",
            appId: "1:424082143710:web:8b51fe37c4fbed77cbb2d6"
        };
        let database;
        let firebaseInitialized = false;
        try {
            firebase.initializeApp(firebaseConfig);
            database = firebase.database();
            firebaseInitialized = true;
            document.getElementById('firebaseStatus').textContent = '✓ Connected to leaderboard';
            document.getElementById('firebaseStatus').classList.add('connected');
        } catch (error) {
            console.error('Firebase initialization failed:', error);
            document.getElementById('firebaseStatus').textContent = '⚠ Leaderboard offline (configure Firebase)';
            document.getElementById('firebaseStatus').classList.add('error');
        }
        function submitScoreToLeaderboard(playerName, score) {
            if (!firebaseInitialized) {
                alert('Leaderboard is offline. Configure Firebase to enable.');
                return;
            }
            if (!playerName || playerName.trim() === '') {
                alert('Please enter your name!');
                return;
            }
            playerName = playerName.trim().substring(0, 20);
            const usernameKey = playerName.toLowerCase().replace(/\s+/g, '').replace(/[^a-z0-9]/g, '');
            if (!usernameKey) {
                alert('Please use letters or numbers in your name!');
                return;
            }
            const userRef = database.ref('leaderboard/' + usernameKey);
            userRef.once('value').then(snapshot => {
                let shouldUpdate = true;
                if (snapshot.exists()) {
                    const existingScore = snapshot.val().score;
                    const existingName = snapshot.val().name;
                    if (score <= existingScore) {
                        shouldUpdate = false;
                        alert(`Your previous best score was ${existingScore}. Play again to beat it! 🎯`);
                    } else {
                        alert(`New high score! Previous: ${existingScore}, New: ${score} 🎉`);
                    }
                    playerName = existingName;
                }
                if (shouldUpdate) {
                    return userRef.set({
                        name: playerName,
                        score: score,
                        timestamp: Date.now(),
                        hash: btoa(score + '' + Date.now() + 'zookeeper2026')
                    }).then(() => {
                        if (!snapshot.exists()) {
                            showAchievement('🎯', 'Score Submitted!', `You're on the leaderboard!`);
                        }
                        localStorage.setItem('playerName', playerName);
                    });
                }
            }).catch(error => {
                console.error('Error submitting score:', error);
                alert('Failed to submit score. Please try again.');
            });
        }
        function loadLeaderboard() {
            if (!firebaseInitialized) {
                document.getElementById('leaderboardList').innerHTML =
                    '<p class="loading">Leaderboard offline. Configure Firebase in the code.</p>';
                return;
            }
            document.getElementById('leaderboardList').innerHTML = '<p class="loading">Loading...</p>';
            database.ref('leaderboard')
                .once('value')
                .then(snapshot => {
                    const scores = [];
                    snapshot.forEach(child => {
                        scores.push(child.val());
                    });
                    scores.sort((a, b) => b.score - a.score);
                    if (scores.length === 0) {
                        document.getElementById('leaderboardList').innerHTML =
                            '<p class="loading">No scores yet. Be the first!</p>';
                        return;
                    }
                    let html = '';
                    scores.forEach((entry, index) => {
                        const rank = index + 1;
                        let rankClass = '';
                        let rankEmoji = '';
                        if (rank === 1) {
                            rankClass = 'top1';
                            rankEmoji = '🥇';
                        } else if (rank === 2) {
                            rankClass = 'top2';
                            rankEmoji = '🥈';
                        } else if (rank === 3) {
                            rankClass = 'top3';
                            rankEmoji = '🥉';
                        }
                        html += `
                            <div class="leaderboard-item ${rankClass}">
                                <div class="leaderboard-rank">${rankEmoji || '#' + rank}</div>
                                <div class="leaderboard-name">${escapeHtml(entry.name)}</div>
                                <div class="leaderboard-score">${entry.score}</div>
                            </div>
                        `;
                    });
                    document.getElementById('leaderboardList').innerHTML = html;
                })
                .catch(error => {
                    console.error('Error loading leaderboard:', error);
                    document.getElementById('leaderboardList').innerHTML =
                        '<p class="loading">Error loading leaderboard.</p>';
                });
        }
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }
        let highScore = parseInt(localStorage.getItem('zooKeeperHighScore') || 0);
        let bestStreak = parseInt(localStorage.getItem('bestStreak') || 0);
        let totalPlays = parseInt(localStorage.getItem('totalPlays') || 0);
        let totalAnimalsCaught = parseInt(localStorage.getItem('totalAnimalsCaught') || 0);
        let totalPointsEarned = parseInt(localStorage.getItem('totalPointsEarned') || 0);
        // let totalPowerupsCaught = parseInt(localStorage.getItem('totalPowerupsCaught') || 0);
        let totalPremiumsCaught = parseInt(localStorage.getItem('totalPremiumsCaught') || 0);
        let premiumSpeciesCaught = JSON.parse(localStorage.getItem('premiumSpeciesCaught') || '[]');
        // let totalPremiumsCaught = parseInt(localStorage.getItem('totalPremiumsCaught') || 0)
        let highestLevelReached = parseInt(localStorage.getItem('highestLevelReached') || 1);
        let highestZoneReached = localStorage.getItem('highestZoneReached') || 'Training Grounds';
        let animalCounts = JSON.parse(localStorage.getItem('animalCounts') || '{}');
        let achievements = JSON.parse(localStorage.getItem('achievements') || '{}');
        let dangerItems = [];
        let lastDangerSpawn = 0;
        let lastHeartSpawn = 0;
        let currentZone = 'Training Grounds'; // ADD
        let isDragging = false;
        let premiumUnlocked = localStorage.getItem('premiumUnlocked') === 'true';
        // Show/hide premium button based on unlock status
function updatePremiumButton() {
    if (premiumUnlocked) {
        document.getElementById('premiumBtn').style.display = 'none';
        document.getElementById('premiumStatus').classList.remove('hidden');
    } else {
        document.getElementById('premiumBtn').style.display = 'flex';
        document.getElementById('premiumStatus').classList.add('hidden');
    }
}
// Call on page load
updatePremiumButton();
    
        const BASKET_RADIUS = 40;
    
   
        let backgroundElements = []; // ADD
let currentZoneIndex = 0; // Tracks current zone
// ADD THE DEBUG TOGGLE HERE
const DEBUG_FAST_ZONES = false; // Set to true for testing 1000-point zones, false for normal 2000-point progression
const progressionZones = [
    { name: "Training Grounds", background: "linear-gradient(180deg, #87CEEB 0%, #B0E0E6 50%, #90EE90 100%)", color: "#667eea", emojiZone: "Training Grounds" },
    { name: "Arctic Tundra", background: "linear-gradient(180deg, #1e3a5f 0%, #2e5984 40%, #87ceeb 100%)", color: "#4ECDC4", emojiZone: "Arctic Tundra" },
    { name: "Jungle Paradise", background: "linear-gradient(180deg, #1a4d2e 0%, #2d5a3d 40%, #4f7942 100%)", color: "#4ade80", emojiZone: "Jungle Paradise" },
    { name: "Savanna Sunset", background: "linear-gradient(180deg, #8B4513 0%, #CD853F 40%, #DAA520 100%)", color: "#FFA500", emojiZone: "Savanna Sunset" }, // ← Change
    { name: "Mystic Forest", background: "linear-gradient(180deg, #2C1654 0%, #4A235A 40%, #6C3483 100%)", color: "#9B59B6", emojiZone: "Mystic Forest" }, // ← Change
    { name: "Volcanic Valley", background: "linear-gradient(180deg, #4A0E0E 0%, #7D2020 40%, #B22222 100%)", color: "#FF6B6B", emojiZone: "Volcanic Valley" }, // ← Change
    { name: "Ocean Depths", background: "linear-gradient(180deg, #001f3f 0%, #003d5c 40%, #0074D9 100%)", color: "#00D4FF", emojiZone: "Ocean Depths" }
];
// Custom score thresholds for each zone (index matches progressionZones)
// Zone 0: 0 points, Zone 1: 3000+, Zone 2: 8000+, etc.
const zoneScoreThresholds = [0, 10000, 20000, 40000, 80000, 100000,150000];
function createBackgroundElements(zoneName) {
    backgroundElements = []; // clear previous
    if (zoneName === "Training Grounds") {
        // existing sun + clouds...
        for (let i = 0; i < 4; i++) {
            backgroundElements.push({
                emoji: "☁️",
                x: Math.random() * gameWidth,
                y: 150 + Math.random() * 200,
                speed: 0.3 + Math.random() * 0.4,
                size: 35 + Math.random() * 15
            });
        }
        backgroundElements.push({
            emoji: "☀️",
            x: gameWidth / 2,
            y: 70,
            speed: 0,
            size: 45
        });
    }
    else if (zoneName === "Arctic Tundra") {
        // existing snowflakes...
        for (let i = 0; i < 12; i++) {
            backgroundElements.push({
                emoji: "❄️",
                x: Math.random() * gameWidth,
                y: -50 - Math.random() * gameHeight,
                speedY: 1.2 + Math.random() * 1.8,
                swayAmount: 30 + Math.random() * 40,
                swaySpeed: 0.02 + Math.random() * 0.03,
                swayOffset: Math.random() * Math.PI * 2,
                rotation: 0,
                rotationSpeed: 0.02 + Math.random() * 0.04,
                size: 18 + Math.random() * 9
            });
        }
    }
    else if (zoneName === "Jungle Paradise") {
        // 🍃 FALLING LEAVES
        for (let i = 0; i < 14; i++) {
            backgroundElements.push({
                emoji: "🍃",
                x: Math.random() * gameWidth,
                y: -50 - Math.random() * gameHeight,
                speedY: 0.8 + Math.random() * 1.0,
                swayAmount: 30 + Math.random() * 50,
                swaySpeed: 0.01 + Math.random() * 0.03,
                swayOffset: Math.random() * Math.PI * 2,
                rotation: 0,
                rotationSpeed: 0.03 + Math.random() * 0.06,
                size: 30 + Math.random() * 15
            });
        }
        // 🌿 VINES / EXTRA LEAVES (slow drifting)
        for (let i = 0; i < 6; i++) {
            backgroundElements.push({
                emoji: "🌿",
                x: Math.random() * gameWidth,
                y: Math.random() * (gameHeight - 250),
                speed: 0.2 + Math.random() * 0.3,
                size: 32 + Math.random() * 10
            });
        }
        // 🦋 BUTTERFLIES (horizontal wave motion)
        for (let i = 0; i < 4; i++) {
            backgroundElements.push({
                emoji: "🦋",
                x: -80 - Math.random() * 100,
                y: 120 + Math.random() * (gameHeight - 320),
                speed: 0.4 + Math.random() * 0.6,
                waveAmount: 40,
                waveSpeed: 0.02,
                waveOffset: Math.random() * Math.PI * 2,
                size: 36
            });
        }
    }
    else if (zoneName === "Savanna Sunset") {
        // 🦅 FLYING EAGLES (horizontal wave motion)
        for (let i = 0; i < 3; i++) {
            backgroundElements.push({
                emoji: "🦅",
                x: -100 - Math.random() * 150,
                y: 80 + Math.random() * 200,
                speed: 0.5 + Math.random() * 0.4,
                waveAmount: 20,
                waveSpeed: 0.015,
                waveOffset: Math.random() * Math.PI * 2,
                size: 40
            });
        }
    
        // 🌾 GRASS BLOWING (slow drift)
        for (let i = 0; i < 8; i++) {
            backgroundElements.push({
                emoji: "🌾",
                x: Math.random() * gameWidth,
                y: gameHeight - 200 + Math.random() * 80,
                speed: 0.15 + Math.random() * 0.2,
                size: 28 + Math.random() * 8
            });
        }
    
        // 🌳 ACACIA TREE (static, background)
        backgroundElements.push({
            emoji: "🌳",
            x: gameWidth * 0.75,
            y: gameHeight - 180,
            speed: 0,
            size: 50
        });
    }
    else if (zoneName === "Mystic Forest") {
        // 🍄 FLOATING MUSHROOMS (drift upward)
        for (let i = 0; i < 10; i++) {
            backgroundElements.push({
                emoji: "🍄",
                x: Math.random() * gameWidth,
                y: 100 + Math.random() * (gameHeight - 300),
                speedY: -0.3 - Math.random() * 0.4,
                swayAmount: 20 + Math.random() * 30,
                swaySpeed: 0.02 + Math.random() * 0.02,
                swayOffset: Math.random() * Math.PI * 2,
                size: 24 + Math.random() * 12
            });
        }
    
        // ✨ SPARKLES (floating upward)
        for (let i = 0; i < 15; i++) {
            backgroundElements.push({
                emoji: "✨",
                x: Math.random() * gameWidth,
                y: Math.random() * gameHeight,
                speedY: -0.5 - Math.random() * 0.8,
                swayAmount: 15,
                swaySpeed: 0.03,
                swayOffset: Math.random() * Math.PI * 2,
                size: 16 + Math.random() * 8
            });
        }
    
        // 🌙 MYSTIC MOON (static)
        backgroundElements.push({
            emoji: "🌙",
            x: gameWidth * 0.8,
            y: 60,
            speed: 0,
            size: 50
        });
    }
    else if (zoneName === "Volcanic Valley") {
        // 🔥 RISING FLAMES
        for (let i = 0; i < 6; i++) {
            backgroundElements.push({
                emoji: "🔥",
                x: Math.random() * gameWidth,
                y: gameHeight + Math.random() * 100,
                speedY: -0.6 - Math.random() * 0.6,
                swayAmount: 20 + Math.random() * 15,
                swaySpeed: 0.02 + Math.random() * 0.02,
                swayOffset: Math.random() * Math.PI * 2,
                rotation: 0,
                rotationSpeed: 0.02 + Math.random() * 0.02,
                size: 20 + Math.random() * 10,
                opacity: 0.4
            });
        }
    
        // 💥 EXPLOSIONS
        for (let i = 0; i < 3; i++) {
            backgroundElements.push({
                emoji: "💥",
                x: Math.random() * gameWidth,
                y: gameHeight - 100 - Math.random() * 150,
                speed: 0,
                pulse: true,
                pulseSpeed: 0.02,
                pulseOffset: Math.random() * Math.PI * 2,
                size: 25 + Math.random() * 10,
                opacity: 0.3
            });
        }
    
        // 🌋 VOLCANO
        backgroundElements.push({
            emoji: "🌋",
            x: gameWidth * 0.15,
            y: gameHeight - 140,
            speed: 0,
            size: 60
        });
    }
    else if (zoneName === "Ocean Depths") {
        // 🫧 RISING BUBBLES
        for (let i = 0; i < 20; i++) {
            backgroundElements.push({
                emoji: "🫧",
                x: Math.random() * gameWidth,
                y: gameHeight + Math.random() * 200,
                speedY: -0.8 - Math.random() * 1.2,
                swayAmount: 15 + Math.random() * 25,
                swaySpeed: 0.02 + Math.random() * 0.03,
                swayOffset: Math.random() * Math.PI * 2,
                size: 20 + Math.random() * 15,
                opacity: 0.6
            });
        }
      
        // 🌊 WAVES
        for (let i = 0; i < 5; i++) {
            backgroundElements.push({
                emoji: "🌊",
                x: Math.random() * gameWidth,
                y: 100 + Math.random() * 150,
                speed: 0.3 + Math.random() * 0.4,
                size: 35 + Math.random() * 10
            });
        }
      
        // 🪸 CORAL
        backgroundElements.push({
            emoji: "🪸",
            x: gameWidth * 0.2,
            y: gameHeight - 150,
            speed: 0,
            size: 45
        });
    }
    else {
        // Other zones: no emojis
        backgroundElements = [];
    }
}
        const dangerTypes = [
    { emoji: '💣', name: 'bomb', penalty: -1, color: '#FF0000' },
    { emoji: '🧨', name: 'tnt', penalty: -1, color: '#FF4500' }
];
        // ============ NEW CELEBRATION & FEATURE CODE ============
// Achievement tracker for gameplay
let gameAchievementTracker = {
    catchTimestamps: [],
    consecutiveCatches: 0,
    livesEarnedThisGame: 0,
    powerupsCaughtThisGame: 0
};
// Extended achievements
const achievementsList = {
    first100: { id: 'first100', name: 'Century Club', desc: 'Catch 100 animals', icon: '💯', target: 100, type: 'totalCaught' },
    speedDemon: { id: 'speedDemon', name: 'Speed Demon', desc: 'Catch 5 in 3 seconds', icon: '⚡', type: 'speed' },
    comboKing: { id: 'comboKing', name: 'Combo King', desc: 'Reach 15x combo', icon: '👑', target: 15, type: 'combo' },
    noMiss: { id: 'noMiss', name: 'Perfect Start', desc: 'Catch first 20 without missing', icon: '🎯', target: 20, type: 'perfect' },
    scoreHero: { id: 'scoreHero', name: 'Score Hero', desc: 'Reach 500 points', icon: '🌟', target: 500, type: 'score' },
    powerupMaster: { id: 'powerupMaster', name: 'Power-Up Master', desc: 'Catch 10 power-ups', icon: '6️⃣7️⃣', target: 10, type: 'powerups' },
    lifeGuard: { id: 'lifeGuard', name: 'Life Guard', desc: 'Earn 5 lives in one game', icon: '❤️', target: 5, type: 'livesEarned' },
    zoneExplorer: { id: 'zoneExplorer', name: 'Zone Explorer', desc: 'Reach the Arctic', icon: '🗺️', target: 10, type: 'level' }
};
// Zone themes
const zones = [
    // { name: 'Training Grounds', levels: [1, 2, 3, 4, 5, 6, 7, 8, 9], background: 'linear-gradient(180deg, #0f1729 0%, #1a2332 40%, #2d3748 100%)', color: '#667eea' },
    {
        name: 'Training Grounds',
        levels: [1, 2, 3, 4, 5, 6, 7, 8, 9],
        background: 'linear-gradient(180deg, #87CEEB 0%, #B0E0E6 50%, #90EE90 100%)', // Sky blue → grass green
        color: '#667eea',
        emoji: '🏕️'
    },
    { name: 'Jungle Paradise 🌴', levels: [10, 11, 12, 13, 14, 15, 16, 17, 18, 19], background: 'linear-gradient(180deg, #1a4d2e 0%, #2d5a3d 40%, #4f7942 100%)', color: '#4ade80' },
    { name: 'Arctic Tundra ❄️', levels: [20, 21, 22, 23, 24, 25, 26, 27, 28, 29], background: 'linear-gradient(180deg, #1e3a5f 0%, #2e5984 40%, #87ceeb 100%)', color: '#4ECDC4' },
    { name: 'Savanna Sunset 🦁', levels: [30, 31, 32, 33, 34, 35, 36, 37, 38, 39], background: 'linear-gradient(180deg, #8B4513 0%, #CD853F 40%, #DAA520 100%)', color: '#FFA500' },
    { name: 'Mystic Forest 🌙', levels: [40, 41, 42, 43, 44, 45, 46, 47, 48, 49], background: 'linear-gradient(180deg, #2C1654 0%, #4A235A 40%, #6C3483 100%)', color: '#9B59B6' },
    { name: 'Volcanic Valley 🌋', levels: [50, 51, 52, 53, 54, 55, 56, 57, 58, 59], background: 'linear-gradient(180deg, #4A0E0E 0%, #7D2020 40%, #B22222 100%)', color: '#FF6B6B' }
];
// Confetti celebration
function throwConfetti(count = 50) {
    const colors = ['#FFD700', '#FF6B6B', '#4ECDC4', '#45B7D1', '#FFA07A', '#98D8C8', '#F7DC6F'];
    for (let i = 0; i < count; i++) {
        setTimeout(() => {
            const confetti = document.createElement('div');
            confetti.className = 'confetti';
            confetti.style.left = Math.random() * 100 + '%';
            confetti.style.background = colors[Math.floor(Math.random() * colors.length)];
            confetti.style.animationDelay = Math.random() * 0.3 + 's';
            confetti.style.animationDuration = (Math.random() * 1 + 1.5) + 's';
            document.body.appendChild(confetti);
        
            setTimeout(() => confetti.remove(), 2500);
        }, i * 30);
    }
}
// Screen shake
function shakeScreen() {
    const gameContainer = document.getElementById('gameContainer');
    gameContainer.classList.add('shake');
    setTimeout(() => gameContainer.classList.remove('shake'), 500);
}
// Fireworks
function launchFirework(x, y) {
    const colors = ['#FFD700', '#FF6B6B', '#4ECDC4', '#45B7D1', '#FFA07A'];
    const particleCount = 30;
    for (let i = 0; i < particleCount; i++) {
        const firework = document.createElement('div');
        firework.className = 'firework';
        firework.style.left = x + 'px';
        firework.style.top = y + 'px';
        firework.style.background = colors[Math.floor(Math.random() * colors.length)];
    
        const angle = (Math.PI * 2 * i) / particleCount;
        const velocity = 50 + Math.random() * 50;
        const tx = Math.cos(angle) * velocity;
        const ty = Math.sin(angle) * velocity;
    
        firework.style.setProperty('--tx', tx + 'px');
        firework.style.setProperty('--ty', ty + 'px');
        firework.style.animation = 'fireworkBurst 1s ease-out forwards';
    
        document.body.appendChild(firework);
        setTimeout(() => firework.remove(), 1000);
    }
}
// Celebration types
function celebrateAchievement(type) {
    switch(type) {
        case 'highscore':
            // throwConfetti(100);
            launchFirework(window.innerWidth / 2, window.innerHeight / 2);
            shakeScreen();
            break;
        case 'combo':
            //throwConfetti(30);
            break;
        case 'milestone':
            launchFirework(window.innerWidth / 2, 200);
            // throwConfetti(50);
            break;
        case 'levelup':
            shakeScreen();
            //throwConfetti(40);
            break;
    }
}
// Get current zone
function getCurrentZone(level) {
    for (let zone of zones) {
        if (zone.levels.includes(level)) {
            return zone;
        }
    }
    return zones[zones.length - 1];
}
function showZoneTransition(zoneName) {
    const zoneEmojis = {
        "Training Grounds": "🏕️",
        "Arctic Tundra": "❄️",
        "Jungle Paradise": "🌴",
        "Savanna Sunset": "🦁",
        "Mystic Forest": "🌙",
        "Volcanic Valley": "🌋"
    };
    const emoji = zoneEmojis[zoneName] || "🌍";
    const modal = document.getElementById('zoneTransitionModal');
    document.getElementById('zoneModalTitle').textContent = `Entering ${zoneName}`;
    document.getElementById('zoneModalEmoji').textContent = emoji;
    modal.classList.remove('hidden');
    setTimeout(() => modal.classList.add('active'), 10);
    paused = true; // Freeze the game
    setTimeout(() => {
        modal.classList.remove('active');
        setTimeout(() => {
            modal.classList.add('hidden');
            paused = false; // Resume the game
        }, 400);
    }, 2000); // 2 seconds pause - change 2000 to 3000 for longer if you want
}
// Combo voice messages
function playComboSound(comboLevel) {
    if (!audioCtx) return;
    const messages = [
        { min: 3, text: 'Nice!', freq: 600 },
        { min: 5, text: 'Great!', freq: 700 },
        { min: 7, text: 'Amazing!', freq: 800 },
        { min: 10, text: 'Incredible!', freq: 900 },
        { min: 15, text: 'UNSTOPPABLE!', freq: 1000 },
        { min: 20, text: 'LEGENDARY!', freq: 1200 }
    ];
    let message = messages[0];
    for (let msg of messages) {
        if (comboLevel >= msg.min) {
            message = msg;
        }
    }
    showComboMessage(message.text);
}
// Visual combo message
function showComboMessage(text) {
    const popup = document.createElement('div');
    popup.style.cssText = `
        position: fixed; top: 30%; left: 50%;
        transform: translate(-50%, 0) scale(0);
        font-size: 48px; font-weight: 900;
        color: #FFD700;
        text-shadow: 0 0 20px rgba(255, 215, 0, 1),
                     0 0 40px rgba(255, 215, 0, 0.8),
                     0 4px 0 rgba(0,0,0,0.5);
        z-index: 6000;
        pointer-events: none;
        animation: comboPop 1.5s ease-out forwards;
    `;
    popup.textContent = text;
    document.body.appendChild(popup);
    setTimeout(() => popup.remove(), 1500);
}
// Check achievements
function checkAchievement(achievementId) {
    const ach = achievementsList[achievementId];
    if (!ach || achievements[achievementId]) return;
    let unlocked = false;
    switch(ach.type) {
        case 'totalCaught':
            if (totalAnimalsCaught >= ach.target) unlocked = true;
            break;
        case 'combo':
            if (combo >= ach.target) unlocked = true;
            break;
        case 'score':
            if (score >= ach.target) unlocked = true;
            break;
        case 'powerups':
            if (gameAchievementTracker.powerupsCaughtThisGame >= ach.target) unlocked = true;
            break;
        case 'livesEarned':
            if (gameAchievementTracker.livesEarnedThisGame >= ach.target) unlocked = true;
            break;
        case 'perfect':
            if (gameAchievementTracker.consecutiveCatches >= ach.target) unlocked = true;
            break;
        case 'level':
            if (difficulty >= ach.target) unlocked = true;
            break;
    }
    if (unlocked) {
        achievements[achievementId] = true;
        localStorage.setItem('achievements', JSON.stringify(achievements));
        showAchievement(ach.icon, ach.name, ach.desc);
        // celebrateAchievement('milestone');
    }
}
// Speed demon check
function checkSpeedDemon() {
    const now = Date.now();
    gameAchievementTracker.catchTimestamps.push(now);
    gameAchievementTracker.catchTimestamps = gameAchievementTracker.catchTimestamps.filter(
        time => now - time <= 3000
    );
    if (gameAchievementTracker.catchTimestamps.length >= 5) {
        checkAchievement('speedDemon');
    }
}
// Reset tracker
function resetGameTracker() {
    gameAchievementTracker = {
        catchTimestamps: [],
        consecutiveCatches: 0,
        livesEarnedThisGame: 0,
        powerupsCaughtThisGame: 0
    };
}
// ============ END NEW CODE ============
        function updateMainMenuHighScore() {
            const currentHighScore = parseInt(localStorage.getItem('zooKeeperHighScore') || 0);
            highScore = currentHighScore;
            document.getElementById('highScoreText').textContent = `High Score: ${currentHighScore}`;
        }
        // updateMainMenuHighScore();
        let audioCtx = null;
        let audioInitialized = false;
        function initAudio() {
            if (!audioInitialized) {
                audioCtx = new (window.AudioContext || window.webkitAudioContext)();
                audioInitialized = true;
            }
        }
        function beep(freq, duration, type = 'sine', vol = 0.3) {
            if (!audioCtx) return;
            try {
                if (audioCtx.state === 'suspended') audioCtx.resume();
                const osc = audioCtx.createOscillator();
                const gain = audioCtx.createGain();
                osc.connect(gain);
                gain.connect(audioCtx.destination);
                osc.type = type;
                osc.frequency.value = freq;
                gain.gain.setValueAtTime(vol, audioCtx.currentTime);
                gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + duration);
                osc.start();
                osc.stop(audioCtx.currentTime + duration);
            } catch(e) {}
        }
        function catchSound() {
    beep(523, 0.08);
    // Better haptics for modern devices
    if (navigator.vibrate) {
        if (combo >= 10) {
            navigator.vibrate([5, 10, 5, 10, 5]); // Triple tap for big combos
        } else if (combo >= 5) {
            navigator.vibrate([5, 10, 5]); // Double tap for combos
        } else {
            navigator.vibrate(10); // Quick tap
        }
    }
}
        function powerupSound() {
            for(let i = 0; i < 8; i++) {
                setTimeout(() => beep(400 + (i * 80), 0.1, 'sine', 0.5), i * 60);
            }
        }
        function bigWinSound() {
            for(let i = 0; i < 6; i++) {
                setTimeout(() => beep(523 + (i * 100), 0.15, 'sine', 0.4), i * 100);
            }
        }
       
function missSound() {
    if (!audioCtx) return;
   
    // Resume audio context if suspended
    if (audioCtx.state === 'suspended') audioCtx.resume();
   
    // Sad descending tones (C → G → E)
    const now = audioCtx.currentTime;
   
    // Note 1: High C (523 Hz)
    const osc1 = audioCtx.createOscillator();
    const gain1 = audioCtx.createGain();
    osc1.connect(gain1);
    gain1.connect(audioCtx.destination);
    osc1.frequency.value = 523;
    gain1.gain.setValueAtTime(0.3, now);
    gain1.gain.exponentialRampToValueAtTime(0.01, now + 0.15);
    osc1.start(now);
    osc1.stop(now + 0.15);
   
    // Note 2: G (392 Hz) - starts after 0.08s
    const osc2 = audioCtx.createOscillator();
    const gain2 = audioCtx.createGain();
    osc2.connect(gain2);
    gain2.connect(audioCtx.destination);
    osc2.frequency.value = 392;
    gain2.gain.setValueAtTime(0.35, now + 0.08);
    gain2.gain.exponentialRampToValueAtTime(0.01, now + 0.25);
    osc2.start(now + 0.08);
    osc2.stop(now + 0.25);
   
    // Note 3: Low E (330 Hz) - starts after 0.16s
    const osc3 = audioCtx.createOscillator();
    const gain3 = audioCtx.createGain();
    osc3.connect(gain3);
    gain3.connect(audioCtx.destination);
    osc3.frequency.value = 330;
    gain3.gain.setValueAtTime(0.4, now + 0.16);
    gain3.gain.exponentialRampToValueAtTime(0.01, now + 0.4);
    osc3.start(now + 0.16);
    osc3.stop(now + 0.4);
    // Gentle "oops" vibration pattern
    if (navigator.vibrate) {
        navigator.vibrate([20, 15, 20]);
    }
}
        function levelUpSound() {
            beep(659, 0.12);
            setTimeout(() => beep(784, 0.12), 70);
            setTimeout(() => beep(880, 0.15), 140);
        }
        function lifeUpSound() {
            beep(523, 0.1);
            setTimeout(() => beep(659, 0.1), 60);
            setTimeout(() => beep(784, 0.1), 120);
            setTimeout(() => beep(1047, 0.2), 180);
        }
        function achievementSound() {
            for(let i = 0; i < 4; i++) {
                setTimeout(() => beep(523 + (i * 100), 0.1), i * 80);
            }
        }
        const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d', { alpha: false });
// Force canvas to use full viewport dimensions
function resizeCanvas() {
    const dpr = window.devicePixelRatio || 1;
    canvas.width = window.innerWidth * dpr;
    canvas.height = window.innerHeight * dpr;
    ctx.scale(dpr, dpr);
}
resizeCanvas();
window.addEventListener('resize', resizeCanvas);
let gameWidth = window.innerWidth;
let gameHeight = window.innerHeight;
        let gameRunning = false;
        let score = 0;
        let lives = 3;
        let combo = 0;
        let streak = 0;
        let maxStreak = 0;
        let animals = [];
        let powerupNumbers = [];
        let lastSpawn = 0;
        let lastPowerupSpawn = 0;
        let rescued = {};
        let difficulty = 1;
        let maxDifficulty = 1;
        let stars = [];
        let particles = [];
        let lastCatch = 0;
        let slowMoActive = false;
        let slowMoEndTime = 0;
        let powerupsCaught = 0;
        let paused = false; // Tracks if game is paused
        let animationFrameId = null; // Stores the requestAnimationFrame ID for canceling
        for(let i = 0; i < 100; i++) {
            stars.push({
                x: Math.random() * gameWidth,
                y: Math.random() * gameHeight * 0.75,
                size: Math.random() * 2 + 0.5,
                opacity: Math.random() * 0.8 + 0.2,
                twinkle: Math.random() * Math.PI * 2
            });
        }
        const player = {
            x: gameWidth / 2 - 40,
            y: gameHeight - 110,
            width: 80,
            radius: 38
        };
  const types = [
    // REGULAR ANIMALS (available in all zones)
    { emoji: "🐰", name: "Rabbit", points: 10, color: "#FFB6C1", premium: false, zone: "land", baseSpeed: 1.8 },
    { emoji: "🐨", name: "Koala", points: 15, color: "#A9A9A9", premium: false, zone: "land", baseSpeed: 2.0 },
    { emoji: "🦊", name: "Fox", points: 20, color: "#FF4500", premium: false, zone: "land", baseSpeed: 2.2 },
    { emoji: "🦁", name: "Lion", points: 25, color: "#DAA520", premium: false, zone: "land", baseSpeed: 2.4 },
    { emoji: "🐼", name: "Panda", points: 30, color: "#000000", premium: false, zone: "land", baseSpeed: 2.6 },
    { emoji: "🐯", name: "Tiger", points: 35, color: "#FF8C00", premium: false, zone: "land", baseSpeed: 2.8 },
    { emoji: "🐘", name: "Elephant", points: 40, color: "#808080", premium: false, zone: "land", baseSpeed: 3.0 },
    { emoji: "🦒", name: "Giraffe", points: 45, color: "#F4A460", premium: false, zone: "land", baseSpeed: 3.2 },
    // REGULAR ANIMALS - OCEAN ONLY
    { emoji: "🐟", name: "Fish", points: 10, color: "#00D4FF", premium: false, zone: "Ocean Depths", baseSpeed: 1.8 },
    { emoji: "🐙", name: "Octopus", points: 15, color: "#9B59B6", premium: false, zone: "Ocean Depths", baseSpeed: 2.0 },
    { emoji: "🦀", name: "Crab", points: 20, color: "#FF6B6B", premium: false, zone: "Ocean Depths", baseSpeed: 2.2 },
    { emoji: "🐢", name: "Turtle", points: 25, color: "#4ade80", premium: false, zone: "Ocean Depths", baseSpeed: 2.4 },
    { emoji: "🦑", name: "Squid", points: 30, color: "#FF69B4", premium: false, zone: "Ocean Depths", baseSpeed: 2.6 },
    { emoji: "🦞", name: "Lobster", points: 35, color: "#FF4500", premium: false, zone: "Ocean Depths", baseSpeed: 2.8 },
    { emoji: "🐠", name: "Tropical Fish", points: 40, color: "#FFD700", premium: false, zone: "Ocean Depths", baseSpeed: 3.0 },
    { emoji: "🦭", name: "Seal", points: 45, color: "#808080", premium: false, zone: "Ocean Depths", baseSpeed: 3.2 },
    // PREMIUM ANIMALS - TRAINING GROUNDS
    { emoji: "🦄", name: "Unicorn", points: 100, color: "#FF69B4", premium: true, zone: "Training Grounds", baseSpeed: 3.0 },
    { emoji: "🦚", name: "Peacock", points: 110, color: "#4169E1", premium: true, zone: "Training Grounds", baseSpeed: 3.2 },
    // PREMIUM ANIMALS - ARCTIC TUNDRA
    { emoji: "🐺", name: "Arctic Wolf", points: 120, color: "#B0E0E6", premium: true, zone: "Arctic Tundra", baseSpeed: 3.4 },
    { emoji: "🦭", name: "Seal", points: 130, color: "#4682B4", premium: true, zone: "Arctic Tundra", baseSpeed: 3.6 },
    // PREMIUM ANIMALS - JUNGLE PARADISE
    { emoji: "🐒", name: "Golden Monkey", points: 140, color: "#FFD700", premium: true, zone: "Jungle Paradise", baseSpeed: 3.8 },
    { emoji: "🦜", name: "Macaw", points: 150, color: "#00CED1", premium: true, zone: "Jungle Paradise", baseSpeed: 4.0 },
    // PREMIUM ANIMALS - SAVANNA SUNSET
    { emoji: "🦅", name: "Golden Eagle", points: 160, color: "#B8860B", premium: true, zone: "Savanna Sunset", baseSpeed: 4.1 },
    { emoji: "🦓", name: "Zebra", points: 170, color: "#2F4F4F", premium: true, zone: "Savanna Sunset", baseSpeed: 4.2 },
    // PREMIUM ANIMALS - MYSTIC FOREST
    { emoji: "🦉", name: "Moon Owl", points: 180, color: "#9370DB", premium: true, zone: "Mystic Forest", baseSpeed: 4.3 },
    { emoji: "🦇", name: "Mystic Bat", points: 190, color: "#8B008B", premium: true, zone: "Mystic Forest", baseSpeed: 4.4 },
    // PREMIUM ANIMALS - VOLCANIC VALLEY
    { emoji: "🐉", name: "Dragon", points: 200, color: "#FF4500", premium: true, zone: "Volcanic Valley", baseSpeed: 4.5 },
    { emoji: "🕊️", name: "Phoenix", points: 220, color: "#FF6347", premium: true, zone: "Volcanic Valley", baseSpeed: 4.7 },
    // ADD THESE - PREMIUM ANIMALS - OCEAN DEPTHS
    { emoji: "🐳", name: "Blue Whale", points: 230, color: "#4169E1", premium: true, zone: "Ocean Depths", baseSpeed: 4.9 },
    { emoji: "🦈", name: "Shark", points: 250, color: "#708090", premium: true, zone: "Ocean Depths", baseSpeed: 5.0 }
];
 
        const powerupType = {
            emoji: '6️⃣7️⃣',
            name: 'powerup67',
            points: 50,
            baseSpeed: 2.0,
            color: '#00FFFF',
            isPowerup: true
        };
        function showStats() {
    document.getElementById('overlay').classList.add('hidden');
    document.getElementById('statsScreen').classList.remove('hidden');
    const currentHighScore = parseInt(localStorage.getItem('zooKeeperHighScore') || 0);
    document.getElementById('totalGames').textContent = totalPlays;
    document.getElementById('totalAnimals').textContent = totalAnimalsCaught;
    document.getElementById('totalPoints').textContent = totalPointsEarned.toLocaleString();
    document.getElementById('bestScore').textContent = currentHighScore;
    document.getElementById('longestStreak').textContent = bestStreak;
    //document.getElementById('totalPowerups').textContent = totalPowerupsCaught;
    /*if (premiumUnlocked) {
    document.getElementById('totalPremiums').textContent = totalPremiumsCaught;
    document.getElementById('premiumCollection').textContent = `${premiumSpeciesCaught.length}/14`;
} else {
    document.getElementById('totalPremiums').textContent = '🔒';
    document.getElementById('premiumCollection').textContent = '🔒';
}
*/
// For testing - always show counts (remove the if/else check)
document.getElementById('totalPremiums').textContent = totalPremiumsCaught;
document.getElementById('premiumCollection').textContent = `${premiumSpeciesCaught.length}/16`;
    document.getElementById('highestLevel').textContent = highestLevelReached;
    document.getElementById('highestZone').textContent = highestZoneReached;
    // FIX: Capitalize animal name before searching
    let maxCount = 0;
    let favAnimal = 'None';
    for(let animal in animalCounts) {
        if(animalCounts[animal] > maxCount) {
            maxCount = animalCounts[animal];
            // Capitalize first letter to match types array
            const capitalizedName = animal.charAt(0).toUpperCase() + animal.slice(1);
            const type = types.find(t => t.name === capitalizedName);
            if(type) {
                favAnimal = type.emoji + ' ' + capitalizedName;
            }
        }
    }
    document.getElementById('favAnimal').textContent = favAnimal;
}
        function updateDifficultyDisplay() {
            const el = document.getElementById('diffLevel');
            el.textContent = difficulty;
            if(difficulty <= 3) el.className = 'difficulty-level diff-beginner';
            else if(difficulty <= 6) el.className = 'difficulty-level diff-easy';
            else if(difficulty <= 10) el.className = 'difficulty-level diff-medium';
            else if(difficulty <= 15) el.className = 'difficulty-level diff-challenging';
            else if(difficulty <= 20) el.className = 'difficulty-level diff-hard';
            else el.className = 'difficulty-level diff-expert';
        }
        function updateStreakReward() {
            const el = document.getElementById('streakReward');
            if(lives >= 5) {
                el.textContent = 'Max Lives! +100 Bonus Points! 💰';
            } else {
                el.textContent = 'Next: +1 Life! ❤️';
            }
        }
        function createParticles(x, y, color, count = 20) {
            for(let i = 0; i < count; i++) {
                particles.push({
                    x, y,
                    vx: (Math.random() - 0.5) * 10,
                    vy: (Math.random() - 0.5) * 10 - 3,
                    size: Math.random() * 5 + 2,
                    color: color,
                    life: 1
                });
            }
        }
        function updateParticles() {
            for(let i = particles.length - 1; i >= 0; i--) {
                const p = particles[i];
                p.x += p.vx;
                p.y += p.vy;
                p.vy += 0.2;
                p.life -= 0.015;
                if(p.life <= 0) {
                    particles.splice(i, 1);
                } else {
                    ctx.globalAlpha = p.life;
                    ctx.fillStyle = p.color;
                    ctx.beginPath();
                    ctx.arc(p.x, p.y, p.size, 0, Math.PI * 2);
                    ctx.fill();
                }
            }
            ctx.globalAlpha = 1;
        }
        function showAchievement(icon, text, desc) {
            const popup = document.getElementById('achievementPopup');
            document.getElementById('achIcon').textContent = icon;
            document.getElementById('achText').textContent = text;
            document.getElementById('achDesc').textContent = desc;
            popup.classList.add('show');
            achievementSound();
            setTimeout(() => popup.classList.remove('show'), 2500);
        }
        function showBigWin(text) {
            const div = document.createElement('div');
            div.className = 'big-win';
            div.textContent = text;
            document.body.appendChild(div);
            bigWinSound();
            setTimeout(() => div.remove(), 2000);
        }
              function activateSlowMo() {
    slowMoActive = true;
    slowMoEndTime = performance.now() + 2500; // 2.5 seconds from NOW
    document.getElementById('slowmoOverlay').classList.add('active');
    powerupSound();
    showAchievement('⏱️', 'SLOW MOTION!', '2.5 seconds activated!');
    showBigWin('SLOW-MO! ⏱️');
    createParticles(player.x + 40, player.y + 40, '#00FFFF', 50);
    // Slow down all existing animals
    animals.forEach(a => {
        if(!a.baseSpeed) a.baseSpeed = a.speed;
        if(!a.baseVx && a.vx !== undefined) a.baseVx = a.vx;
        a.speed *= 0.3;
        if(a.vx !== undefined) a.vx *= 0.3;
    });
        // ⚡ SLOW DOWN DANGER ITEMS TOO! ⚡
    dangerItems.forEach(d => {
        if(!d.baseSpeed) d.baseSpeed = d.speed;
        d.speed *= 0.3;
    });
}
function checkSlowMo(time) {
// Don't run if game isn't active
    if(!gameRunning) {
        slowMoActive = false;
        document.getElementById('slowmoOverlay').classList.remove('active');
        return;
    }
    if(slowMoActive && time >= slowMoEndTime) {
        slowMoActive = false;
        document.getElementById('slowmoOverlay').classList.remove('active');
    
        // Speed up existing animals back to normal
        animals.forEach(a => {
            if(a.baseSpeed) {
                a.speed = a.baseSpeed;
                delete a.baseSpeed;
            }
            if(a.baseVx !== undefined) {
                a.vx = a.baseVx;
                delete a.baseVx;
            }
        });
                    // ⚡ SPEED DANGER ITEMS BACK UP! ⚡
        dangerItems.forEach(d => {
            if(d.baseSpeed) {
                d.speed = d.baseSpeed;
                delete d.baseSpeed;
            }
        });
    }
}
        function checkAchievements() {
            if(streak === 5 && !achievements.streak5) {
                achievements.streak5 = true;
                showAchievement('🔥', 'Hot Start!', '5 catch streak');
                localStorage.setItem('achievements', JSON.stringify(achievements));
            }
            if(streak === 15 && !achievements.streak15) {
                achievements.streak15 = true;
                showAchievement('💥', 'On Fire!', '15 catch streak');
                showBigWin('STREAK MASTER!');
                localStorage.setItem('achievements', JSON.stringify(achievements));
            }
            if(score >= 300 && !achievements.score300) {
                achievements.score300 = true;
                showAchievement('⭐', 'Rising Star!', '300 points reached');
                localStorage.setItem('achievements', JSON.stringify(achievements));
            }
            if(score >= 500 && !achievements.score500) {
                achievements.score500 = true;
                showAchievement('💎', 'Diamond!', '500 points!');
                showBigWin('BIG WIN!');
                localStorage.setItem('achievements', JSON.stringify(achievements));
            }
            if(difficulty >= 5 && !achievements.diff5) {
                achievements.diff5 = true;
                showAchievement('🎯', 'Leveling Up!', 'Reached Level 5');
                localStorage.setItem('achievements', JSON.stringify(achievements));
            }
            if(difficulty >= 10 && !achievements.diff10) {
                achievements.diff10 = true;
                showAchievement('👑', 'Expert!', 'Reached Level 10');
                showBigWin('LEVEL 10!');
                localStorage.setItem('achievements', JSON.stringify(achievements));
            }
            if(powerupsCaught >= 3 && !achievements.powerup3) {
                achievements.powerup3 = true;
                showAchievement('⏱️', 'Time Master!', '3 slow-mos caught');
                localStorage.setItem('achievements', JSON.stringify(achievements));
            }
        }
        function drawStars() {
            stars.forEach(star => {
                star.twinkle += 0.02;
                const opacity = star.opacity + Math.sin(star.twinkle) * 0.3;
                ctx.fillStyle = `rgba(255, 255, 255, ${opacity})`;
                ctx.beginPath();
                ctx.arc(star.x, star.y, star.size, 0, Math.PI * 2);
                ctx.fill();
            });
        }
        function drawGround() {
            const gradient = ctx.createLinearGradient(0, gameHeight - 90, 0, gameHeight);
            gradient.addColorStop(0, 'rgba(45, 55, 72, 0.6)');
            gradient.addColorStop(1, 'rgba(26, 32, 44, 0.9)');
            ctx.fillStyle = gradient;
            ctx.fillRect(0, gameHeight - 90, gameWidth, 90);
            ctx.strokeStyle = 'rgba(102, 126, 234, 0.3)';
            ctx.lineWidth = 2;
            ctx.beginPath();
            ctx.moveTo(0, gameHeight - 90);
            ctx.lineTo(gameWidth, gameHeight - 90);
            ctx.stroke();
        }
                   function spawnPowerup() {
                const speedMultiplier = slowMoActive ? 0.3 : (Math.min(1 + (difficulty * 0.06), 1.8));
                powerupNumbers.push({
                    x: Math.random() * (gameWidth - 80) + 40,
                    y: -50,
                    type: powerupType,
                    rotation: 0,
                    speed: powerupType.baseSpeed * speedMultiplier,
                
                    // NEW: Randomized motion for powerups too
                    swerveSpeed: (Math.random() * 0.04 + 0.01) * (Math.random() > 0.5 ? 1 : -1),
                    swerveAmount: 15 + Math.random() * 30,
                    swerveOffset: Math.random() * Math.PI * 2,
                
                    // NEW: Random horizontal velocity
                    vx: (Math.random() - 0.5) * 5
                });
            }
                 function spawn() {
    const currentZoneName = progressionZones[currentZoneIndex].name;
  
    // FIXED: Filter regular animals based on current zone
    let regularTypes;
    if (currentZoneName === "Ocean Depths") {
        // In Ocean zone: only show ocean animals
        regularTypes = types.filter(t => !t.premium && t.zone === "Ocean Depths");
    } else {
        // In other zones: only show land animals (exclude ocean animals)
        regularTypes = types.filter(t => !t.premium && t.zone === "land");
    }
  
    // Premium animals only in their correct zone
    const premiumTypes = types.filter(t => t.premium && t.zone === currentZoneName);
  
    // Choose 10% chance for premium if UNLOCKED and available
    let type;
    if (premiumUnlocked && premiumTypes.length > 0 && Math.random() < 0.1) {
        type = premiumTypes[Math.floor(Math.random() * premiumTypes.length)];
    } else {
        type = regularTypes[Math.floor(Math.random() * regularTypes.length)];
    }
  
    // Zone-based speed boost for regular animals
    // Zone-based speed boost - PREMIUMS ARE SLOWER
    let speedMultiplier;
    if (type.premium) {
        speedMultiplier = slowMoActive ? 0.3 : Math.min(1 + (difficulty * 0.01), 1.3);
    } else {
       if (currentZoneIndex >= 2) {
        speedMultiplier = slowMoActive ? 0.3 : (difficulty >= 40 ? 2.8 :
                                               difficulty >= 30 ? 2.4 :
                                               difficulty >= 20 ? 2.0 :
                                               Math.min(1 + (difficulty * 0.06), 1.8));
        } else {
            speedMultiplier = slowMoActive ? 0.3 : (difficulty >= 40 ? 2.2 :
                                                   difficulty >= 30 ? 2.0 :
                                                   Math.min(1 + (difficulty * 0.06), 1.8));
        }
    }
  
    const swerveSpeedMultiplier = slowMoActive ? 0.3 : (Math.min(1 + (difficulty * 0.05), 1.5));
    const swerveAmountMultiplier = Math.min(1 + (difficulty * 0.08), 1.6);
  
    animals.push({
        x: Math.random() * (gameWidth - 60) + 30,
        y: -50,
        type: type,
        rotation: 0,
        speed: type.baseSpeed * speedMultiplier,
        swerveSpeed: ((Math.random() * 0.03) + 0.01) * swerveSpeedMultiplier * (Math.random() > 0.5 ? 1 : -1),
        swerveAmount: (15 + (Math.random() * 35)) * swerveAmountMultiplier,
        swerveOffset: Math.random() * Math.PI * 2,
        vx: (Math.random() - 0.5) * 4
    });
}
        function spawnDanger() {
    const type = dangerTypes[Math.floor(Math.random() * dangerTypes.length)]; // Random bomb or TNT
    const speedMultiplier = slowMoActive ? 0.3 : (Math.min(1 + (difficulty * 0.06), 1.8));
    dangerItems.push({
        x: Math.random() * (gameWidth - 60) + 30,
        y: -50,
        type: type,
        rotation: 0,
        speed: 2.0 * speedMultiplier, // Falls a bit slower than animals
        swerveSpeed: (Math.random() * 0.02) * (Math.random() > 0.5 ? 1 : -1),
        swerveAmount: 20 + Math.random() * 20,
        swerveOffset: Math.random() * Math.PI * 2,
        vx: (Math.random() - 0.5) * 3
    });
}
        function drawPlayer() {
            const outerGlow = ctx.createRadialGradient(
                player.x + 40, player.y + 40, 0,
                player.x + 40, player.y + 40, player.radius + 20
            );
            outerGlow.addColorStop(0, 'rgba(102, 126, 234, 0.4)');
            outerGlow.addColorStop(0.5, 'rgba(118, 75, 162, 0.2)');
            outerGlow.addColorStop(1, 'rgba(102, 126, 234, 0)');
            ctx.fillStyle = outerGlow;
            ctx.beginPath();
            ctx.arc(player.x + 40, player.y + 40, player.radius + 20, 0, Math.PI * 2);
            ctx.fill();
            const platform = ctx.createRadialGradient(
                player.x + 40, player.y + 40, 0,
                player.x + 40, player.y + 40, player.radius
            );
            platform.addColorStop(0, 'rgba(102, 126, 234, 0.25)');
            platform.addColorStop(1, 'rgba(102, 126, 234, 0.05)');
            ctx.fillStyle = platform;
            ctx.beginPath();
            ctx.arc(player.x + 40, player.y + 40, player.radius, 0, Math.PI * 2);
            ctx.fill();
            ctx.strokeStyle = 'rgba(102, 126, 234, 0.6)';
            ctx.lineWidth = 3;
            ctx.beginPath();
            ctx.arc(player.x + 40, player.y + 40, player.radius + 5, 0, Math.PI * 2);
            ctx.stroke();
            ctx.fillStyle = '#000000';
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            ctx.font = '38px Arial, "Apple Color Emoji", sans-serif';
            ctx.fillText('🧺', player.x + 40, player.y + 35);
        }
        function drawAnimals() {
    const emojiSize = window.innerWidth > 768 ? 64 : 48;
    // Draw animals with premium flair
    animals.forEach(a => {
        ctx.save();
        ctx.translate(a.x, a.y);
        ctx.rotate(a.rotation);
        if (a.type.premium) {
            // Pulsing golden glow
            const pulse = 1 + Math.sin(performance.now() / 200) * 0.2;
            ctx.shadowColor = '#FFD700';
            ctx.shadowBlur = 35 * pulse;
            // Larger size for premium
            ctx.font = `${emojiSize * 1.25}px Arial, "Apple Color Emoji", sans-serif`;
        } else {
            ctx.font = `${emojiSize}px Arial, "Apple Color Emoji", sans-serif`;
        }
        ctx.fillStyle = '#000000';
        ctx.textAlign = 'center';
        ctx.textBaseline = 'middle';
        ctx.fillText(a.type.emoji, 0, 0);
        // Reset shadow
        ctx.shadowBlur = 0;
        ctx.restore();
        // Rotation update
        a.rotation += slowMoActive ? 0.015 : (0.04 + (difficulty * 0.003));
        a.currentX = a.x;
        // Premium trailing sparkles (magical trail)
        if (a.type.premium && Math.random() < 0.35) {
            createParticles(a.x, a.y + 20, '#FFD700', 4);
        }
    });
    // Danger items (unchanged - keep red glow)
    dangerItems.forEach(d => {
        d.swerveOffset += d.swerveSpeed;
        const swerveX = Math.sin(d.swerveOffset) * d.swerveAmount;
        ctx.save();
        ctx.translate(d.x + swerveX, d.y);
        ctx.rotate(d.rotation);
        ctx.shadowColor = '#FF0000';
        ctx.shadowBlur = 25;
        ctx.fillStyle = '#000000';
        ctx.textAlign = 'center';
        ctx.textBaseline = 'middle';
        ctx.font = `${emojiSize}px Arial, "Apple Color Emoji", sans-serif`;
        ctx.fillText(d.type.emoji, 0, 0);
        ctx.shadowBlur = 0;
        ctx.restore();
        d.rotation += slowMoActive ? 0.02 : 0.06;
        d.currentX = d.x + swerveX;
    });
    // Powerups (unchanged - keep cyan glow)
    powerupNumbers.forEach(p => {
        p.swerveOffset += p.swerveSpeed;
        const swerveX = Math.sin(p.swerveOffset) * p.swerveAmount;
        ctx.save();
        ctx.translate(p.x + swerveX, p.y);
        ctx.shadowColor = '#00FFFF';
        ctx.shadowBlur = 20;
        ctx.fillStyle = '#000000';
        ctx.textAlign = 'center';
        ctx.textBaseline = 'middle';
        ctx.font = `${emojiSize}px Arial, "Apple Color Emoji", sans-serif`;
        ctx.fillText(p.type.emoji, 0, 0);
        ctx.shadowBlur = 0;
        ctx.restore();
        p.rotation += slowMoActive ? 0.015 : 0.04;
        p.currentX = p.x + swerveX;
    });
}
        function checkHit(a) {
            const dx = (a.currentX || a.x) - (player.x + 40);
            const dy = a.y - (player.y + 40);
            const dist = Math.sqrt(dx * dx + dy * dy);
            return dist < player.radius + 20;
        }
        function updateScore() {
            document.getElementById('scoreDisplay').textContent = score;
            document.getElementById('scoreBox').classList.add('pulse');
            setTimeout(() => document.getElementById('scoreBox').classList.remove('pulse'), 500);
        }
        function updateStreak() {
            if(streak > maxStreak) maxStreak = streak;
            const displayStreak = streak % 10;
            document.getElementById('streakCount').textContent = `${displayStreak}/10`;
            const progress = displayStreak * 10;
            document.getElementById('progressFill').style.width = progress + '%';
            const bar = document.getElementById('streakBar');
            if(displayStreak >= 7) bar.classList.add('hot');
            else bar.classList.remove('hot');
            if(streak > 0 && streak % 10 === 0) {
                if(lives < 5) {
                    lives++;
                    updateLives();
                     gameAchievementTracker.livesEarnedThisGame++;
                    checkAchievement('lifeGuard');
                    const hearts = document.querySelectorAll('.heart');
                    if(hearts[lives - 1]) {
                        hearts[lives - 1].classList.add('gained');
                        setTimeout(() => hearts[lives - 1].classList.remove('gained'), 500);
                    }
                    lifeUpSound();
                    showAchievement('❤️', 'Bonus Life!', '10 streak reward!');
                    createParticles(player.x + 40, player.y + 40, '#FF1493', 40);
                } else {
                    score += 100;
                    updateScore();
                    showAchievement('💰', 'Bonus Points!', '+100 points!');
                    createParticles(player.x + 40, player.y + 40, '#FFD700', 40);
                }
                updateStreakReward();
            }
                // Life gained haptic
    if (navigator.vibrate) {
        navigator.vibrate([15, 10, 15]); // Positive feedback
    }
        }
        function updateLives() {
            const hearts = document.querySelectorAll('.heart');
            hearts.forEach((h, i) => {
                h.classList.toggle('lost', i >= lives);
            });
        }
        function showCombo() {
            const el = document.getElementById('combo');
            el.textContent = `${combo}x COMBO! 🔥`;
            el.classList.add('show');
            setTimeout(() => el.classList.remove('show'), 1200);
        }
                function updateDifficulty() {
                const newDifficulty = Math.floor(score / 1000) + 1; // Every 1,000 points!
                if (newDifficulty > difficulty) {
                    difficulty = newDifficulty;
                    if(difficulty > maxDifficulty) maxDifficulty = difficulty;
                    updateDifficultyDisplay();
                
            
                
                
                    showAchievement('⬆️', 'Level Up!', `Level ${difficulty}`);
                    checkAchievements();
                
                    // NEW: Check zone achievement
                    checkAchievement('zoneExplorer');
                }
            }
function drawBackground() {
    // LAYER 1: Static background elements first (sun, moon, tree, volcano)
    backgroundElements.forEach((elem) => {
        if (elem.speed === 0 && !elem.speedY && !elem.pulse) {
            ctx.save();
            ctx.font = `${elem.size}px Arial, "Apple Color Emoji", sans-serif`;
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            ctx.fillText(elem.emoji, elem.x, elem.y);
            ctx.restore();
        }
    });
    // LAYER 2: Moving and animated elements
    backgroundElements.forEach((elem) => {
        if (elem.speed > 0 || elem.speedY || elem.pulse) {
            ctx.save();
            ctx.font = `${elem.size}px Arial, "Apple Color Emoji", sans-serif`;
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            let drawX = elem.x;
            let drawY = elem.y;
            // === VERTICAL MOVEMENT (snow, leaves, flames, mushrooms, sparkles) ===
            if (elem.speedY) {
                elem.y += elem.speedY * (slowMoActive ? 0.4 : 1);
                // Apply custom opacity for subtle effects
                if (elem.opacity !== undefined) {
                    ctx.globalAlpha = elem.opacity;
                }
                // Sway side-to-side
                if (elem.swayAmount) {
                    elem.swayOffset = (elem.swayOffset || 0) + elem.swaySpeed;
                    drawX += Math.sin(elem.swayOffset) * elem.swayAmount;
                }
                // Rotation (for leaves, snowflakes, flames)
                if (elem.rotationSpeed) {
                    elem.rotation = (elem.rotation || 0) + elem.rotationSpeed * (slowMoActive ? 0.4 : 1);
                }
                // Draw with rotation if needed
                if (elem.rotation) {
                    ctx.translate(drawX, elem.y);
                    ctx.rotate(elem.rotation);
                    ctx.fillText(elem.emoji, 0, 0);
                } else {
                    ctx.fillText(elem.emoji, drawX, elem.y);
                }
                // Reset opacity
                if (elem.opacity !== undefined) {
                    ctx.globalAlpha = 1.0;
                }
                // Wrap logic
                if (elem.speedY > 0 && elem.y > gameHeight + 60) {
                    // Falling elements: respawn at top
                    elem.y = -60;
                    elem.x = Math.random() * gameWidth;
                    elem.swayOffset = Math.random() * Math.PI * 2;
                } else if (elem.speedY < 0 && elem.y < -60) {
                    // Rising elements: respawn at bottom
                    elem.y = gameHeight + 60;
                    elem.x = Math.random() * gameWidth;
                }
            }
            // === HORIZONTAL MOVEMENT (clouds, eagles, butterflies, grass) ===
            else if (elem.speed > 0) {
                elem.x += elem.speed * (slowMoActive ? 0.4 : 1);
                drawX = elem.x;
                // Vertical wave motion (for eagles and butterflies)
                if (elem.waveAmount) {
                    elem.waveOffset = (elem.waveOffset || 0) + elem.waveSpeed;
                    drawY += Math.sin(elem.waveOffset) * elem.waveAmount;
                }
                ctx.fillText(elem.emoji, drawX, drawY);
                // Wrap horizontally when off-screen
                if (elem.x > gameWidth + 60) {
                    elem.x = -60;
                    if (elem.emoji === '☁️') {
                        elem.y = 150 + Math.random() * 200; // Randomize cloud height
                    }
                }
            }
            // === PULSING EFFECT (explosions) ===
            else if (elem.pulse) {
                const scale = 1 + Math.sin(elem.pulseOffset) * 0.2;
                ctx.globalAlpha = 0.6 + Math.sin(elem.pulseOffset) * 0.3;
                elem.pulseOffset += elem.pulseSpeed;
                ctx.font = `${elem.size * scale}px Arial, "Apple Color Emoji", sans-serif`;
                ctx.fillText(elem.emoji, elem.x, elem.y);
            }
            ctx.restore();
        }
    });
}
function gameLoop(time) {
    if (!gameRunning) return;
    checkSlowMo(time);
        // Progressive zone unlock (challenging milestones - no debug mode)
        // Progressive zone unlock
    const zoneScoreThresholds = [0, 10000, 20000, 40000, 80000, 100000,150000];
    let newZoneIndex = 0;
    for (let i = zoneScoreThresholds.length - 1; i >= 0; i--) {
        if (score >= zoneScoreThresholds[i]) {
            newZoneIndex = i;
            break;
        }
    }
    // In gameLoop(time) - UPDATE the zone entry block (replace your current if-block)
if (newZoneIndex > currentZoneIndex && newZoneIndex < progressionZones.length) {
    currentZoneIndex = newZoneIndex;
 // 👈 ADD THESE 5 LINES HERE:
    const zoneName = progressionZones[currentZoneIndex].name;
    if (progressionZones.findIndex(z => z.emojiZone === highestZoneReached) < currentZoneIndex) {
        highestZoneReached = zoneName;
        localStorage.setItem('highestZoneReached', zoneName);
    }
    // End new lines
 
    const zone = progressionZones[currentZoneIndex];
    // === TRUE FRESH LEVEL START ===
    // Clear EVERYTHING from the old zone (no carry-over animals/particles)
    animals = [];
    powerupNumbers = [];
    dangerItems = [];
    particles = [];
    // FULL SPAWN RESET: Give a calm "new level" moment
    // Animals will NOT spawn for ~2 seconds after the modal fades
    // This creates a dramatic "breath" before the new zone's action begins
    lastSpawn = time + 2000; // 2-second calm (tweak if you want shorter/longer)
    lastPowerupSpawn = time + 12000; // Slightly delayed powerups
    lastDangerSpawn = time + 8000; // Dangers come a bit later
    if (typeof lastHeartSpawn !== 'undefined') lastHeartSpawn = time + 18000;
    // Apply new zone visuals instantly
    const canvas = document.getElementById('gameCanvas');
    canvas.style.background = zone.background;
    document.getElementById('diffLevel').style.color = zone.color;
    if (zone.emojiZone) {
        createBackgroundElements(zone.emojiZone);
    } else {
        backgroundElements = [];
    }
    // Modal + 2-second pause
    showZoneTransition(zone.name);
    throwConfetti(100);
}
    // ALWAYS DRAW THE SCENE (even when paused)
    ctx.clearRect(0, 0, gameWidth, gameHeight);
    drawBackground(); // ← ADD THIS LINE
    drawStars();
    drawGround();
    drawAnimals();
    updateParticles();
    drawPlayer();
    // IF PAUSED: Skip all game logic updates
    if (paused) {
        animationFrameId = requestAnimationFrame(gameLoop);
        return; // Exit early - don't update positions, spawns, collisions
    }
    // ACTIVE GAME LOGIC (only runs when NOT paused)
    // Calculate spawn delay based on difficulty
    const baseSpawnDelay = 1300;
    const reductionPerLevel = 25;
    let minSpawnDelay = 700;
    if (difficulty >= 40) minSpawnDelay = 500;
    else if (difficulty >= 30) minSpawnDelay = 600;
    const spawnDelay = Math.max(minSpawnDelay, baseSpawnDelay - (difficulty * reductionPerLevel));
    // Spawn animals
    if (time - lastSpawn > spawnDelay) {
        spawn(); // CHANGED: was spawnAnimal()
        lastSpawn = time;
    }
    // Spawn power-ups
    if (time - lastPowerupSpawn > 15000) {
        spawnPowerup();
        lastPowerupSpawn = time;
    }
    // Spawn danger items
    if (time - lastDangerSpawn > 3000) {
        if (Math.random() < 0.3) {
            spawnDanger(); // CHANGED: was spawnDangerItem()
        }
        lastDangerSpawn = time;
    }
// ❤️ HEART - VISIBLE FLOAT!
if (time - lastHeartSpawn > 20000 && lives < 5 && Math.random() < 0.05) {
    powerupNumbers.push({
        x: 40 + Math.random() * 100,
        y: 80,
        speed: 1.0, // FASTER fall
        type: {
            points: 500,
            emoji: '❤️',
            color: '#ff4444',
            isHeart: true
        },
        swerveSpeed: 0.02, // ADD SWERVE!
        swerveAmount: 20,
        swerveOffset: Math.random() * Math.PI * 2
    });
    lastHeartSpawn = time;
}
    // ... rest of your code stays the same ...
    // Update and check animals (ALL YOUR ANIMAL LOGIC HERE)
    for (let i = animals.length - 1; i >= 0; i--) {
        animals[i].y += animals[i].speed;
    
        // Add horizontal velocity if it doesn't exist
        if (animals[i].vx === undefined) {
            animals[i].vx = (Math.random() - 0.5) * 3;
        }
    
        // Move horizontally
        animals[i].x += animals[i].vx;
    
        // Bounce off left wall
        if (animals[i].x < 30) {
            animals[i].x = 30;
            animals[i].vx = (1.35 + Math.random() * 1.8);
            createParticles(30, animals[i].y, animals[i].type.color, 8);
            if (audioCtx) beep(400, 0.06, 'sine', 0.15);
        }
    
        // Bounce off right wall
        if (animals[i].x > gameWidth - 30) {
            animals[i].x = gameWidth - 30;
            animals[i].vx = -(1.35 + Math.random() * 1.8);
            createParticles(gameWidth - 30, animals[i].y, animals[i].type.color, 8);
            if (audioCtx) beep(400, 0.06, 'sine', 0.15);
        }
    
        const hit = checkHit(animals[i]);
    
        if (hit === true) {
            catchSound();
            streak++;
            updateStreak();
        
            gameAchievementTracker.consecutiveCatches++;
            checkSpeedDemon();
            checkAchievement('first100');
            checkAchievement('comboKing');
            checkAchievement('noMiss');
            checkAchievement('scoreHero');
            checkAchievement('zoneExplorer');
        
            if (time - lastCatch < 1800) {
                combo++;
                if (combo > 1) showCombo();
                if (combo >= 3) playComboSound(combo);
            } else {
                combo = 1;
            }
            lastCatch = time;
        
            const points = animals[i].type.points * Math.max(1, combo);
            score += points;
              if (animals[i].type.premium) {
    createParticles(animals[i].x, animals[i].y, '#FFD700', 60);
    // ✅ Track total premium catches
    totalPremiumsCaught++;
    localStorage.setItem('totalPremiumsCaught', totalPremiumsCaught);
    // ✅ Track unique species caught (THIS WAS MISSING!)
    if (!premiumSpeciesCaught.includes(animals[i].type.name)) {
        premiumSpeciesCaught.push(animals[i].type.name);
        localStorage.setItem('premiumSpeciesCaught', JSON.stringify(premiumSpeciesCaught));
    
        // Show special achievement for first catch of this species
        showAchievement('✨', 'New Discovery!', `First ${animals[i].type.name} caught!`);
    
        // Master collector achievement (caught all 14)
        if (premiumSpeciesCaught.length === 14) {
            showAchievement('👑', 'Master Collector!', 'All premium animals caught!');
            celebrateAchievement('milestone');
        }
    }
    if (lives < 5) {
        lives++;
        updateLives();
        lifeUpSound();
        const hearts = document.querySelectorAll('.heart');
        if (hearts[lives - 1]) {
            hearts[lives - 1].classList.add('gained');
            setTimeout(() => hearts[lives - 1].classList.remove('gained'), 500);
        }
        showAchievement('❤️', 'Premium Life!', `+1 Life from ${animals[i].type.name}!`);
        createParticles(animals[i].x, animals[i].y, '#FF1493', 40);
    } else {
        score += 100;
        updateScore();
        showAchievement('💰', 'Max Lives Bonus!', '+100 points from premium!');
        createParticles(animals[i].x, animals[i].y, '#FFD700', 50);
    }
    beep(1000, 0.2);
    if (navigator.vibrate) navigator.vibrate([20, 30, 20]);
}
        
            rescued[animals[i].type.name] = (rescued[animals[i].type.name] || 0) + 1;
            animalCounts[animals[i].type.name] = (animalCounts[animals[i].type.name] || 0) + 1;
        
            updateScore();
            updateDifficulty();
        
            createParticles(animals[i].x, animals[i].y, animals[i].type.color, 25);
        
            animals.splice(i, 1);
        
            if (navigator.vibrate) navigator.vibrate(15);
            continue;
        }
    
        // Missed animal - fell off screen
        if (animals[i].y > gameHeight - 90) {
            missSound();
            lives--;
            combo = 0;
            streak = 0;
        
            gameAchievementTracker.consecutiveCatches = 0;
        
            updateStreak();
            updateLives();
            animals.splice(i, 1);
        
           if (lives <= 0) {
    gameRunning = false;
    gameOver = true;
   
    // STOP GAME LOOP
    if (animationFrameId) {
        cancelAnimationFrame(animationFrameId);
        animationFrameId = null;
    }
   
    // KILL ALL AUDIO
    document.querySelectorAll('audio').forEach(audio => {
        audio.pause();
        audio.currentTime = 0;
    });
   
    endGame();
    return;
}
        }
    }
    // Update power-up numbers
for (let i = powerupNumbers.length - 1; i >= 0; i--) {
    powerupNumbers[i].y += powerupNumbers[i].speed;
    // Add swerve if it exists (for consistency with animals/danger)
    if (powerupNumbers[i].swerveOffset !== undefined) {
        powerupNumbers[i].swerveOffset += powerupNumbers[i].swerveSpeed || 0;
        const swerveX = Math.sin(powerupNumbers[i].swerveOffset) * (powerupNumbers[i].swerveAmount || 0);
        powerupNumbers[i].currentX = powerupNumbers[i].x + swerveX;
    }
    const hit = checkHit(powerupNumbers[i]);
    if (hit === true) {
        if (powerupNumbers[i].type?.isHeart) {
            // ❤️ HEART ONLY: Extra life, no slow-mo
            lives = Math.min(5, lives + 1);
            updateLives();
            lifeUpSound();
            createParticles(powerupNumbers[i].x, powerupNumbers[i].y, '#ff4444', 50);
            showAchievement('❤️', 'Extra Life!', 'Heart caught!');
            showBigWin('EXTRA LIFE!');
            if (navigator.vibrate) navigator.vibrate([30, 50, 30]); // Different vibe pattern
        } else {
            // 6️⃣7️⃣ ONLY: Slow-mo + stats
            powerupSound();
            activateSlowMo();
            powerupsCaught++;
            gameAchievementTracker.powerupsCaughtThisGame++;
            checkAchievement('powerupMaster');
            createParticles(powerupNumbers[i].x, powerupNumbers[i].y, '#00FFFF', 40);
            if (navigator.vibrate) navigator.vibrate([10, 30, 10]);
        }
        powerupNumbers.splice(i, 1);
        continue;
    }
    if (powerupNumbers[i].y > gameHeight) {
        powerupNumbers.splice(i, 1);
    }
}
    // Update danger items
    for (let i = dangerItems.length - 1; i >= 0; i--) {
        dangerItems[i].y += dangerItems[i].speed;
    
        const hit = checkHit(dangerItems[i]);
    
        if (hit === true) {
            missSound();
            lives += dangerItems[i].type.penalty;
            createParticles(dangerItems[i].x, dangerItems[i].y, dangerItems[i].type.color, 20);
            dangerItems.splice(i, 1);
            updateLives();
        
            if (navigator.vibrate) navigator.vibrate([50, 50, 50]);
        
         if (lives <= 0) {
    gameRunning = false;
    gameOver = true;
   
    // STOP GAME LOOP
    if (animationFrameId) {
        cancelAnimationFrame(animationFrameId);
        animationFrameId = null;
    }
   
    // KILL ALL AUDIO
    document.querySelectorAll('audio').forEach(audio => {
        audio.pause();
        audio.currentTime = 0;
    });
   
    endGame();
    return;
}
            continue;
        }
    
        if (dangerItems[i].y > gameHeight) {
            dangerItems.splice(i, 1);
        }
    }
    // Continue loop
    animationFrameId = requestAnimationFrame(gameLoop);
}
// BULLETPROOF Portrait Lock
let gamePausedByOrientation = false;
function forcePortraitPause() {
    const isLandscape = window.innerWidth > window.innerHeight;
    if(isLandscape) {
        // FORCE PAUSE - Stop gameLoop completely
        document.body.classList.add('portrait-pause');
        gamePausedByOrientation = true;
        gameRunning = false; // ← CRITICAL: Stops gameLoop
        if(animationFrameId) {
            cancelAnimationFrame(animationFrameId);
            animationFrameId = null;
        }
        // Kill all audio and effects
        if (audioCtx && audioCtx.state === 'running') {
            audioCtx.suspend(); // Kill all beep sounds
        }
        slowMoActive = false;
        document.getElementById('slowmoOverlay')?.classList.remove('active');
        particles = []; // Stop particles
       
    } else if(gamePausedByOrientation) {
        // RESUME ONLY when returning to portrait
        document.body.classList.remove('portrait-pause');
        gamePausedByOrientation = false;
       
        if(paused) {
            // Keep paused - user manually paused with button
            paused = true;
            document.getElementById('pauseOverlay').classList.remove('hidden');
            document.getElementById('pauseButton').style.display = 'none';
        } else {
            gameRunning = true; // Restart gameLoop
            gameLoop(performance.now()); // Restart animation
        }
    }
}
function startGame() {
// RESET DIFFICULTY TO LEVEL 1
    difficulty = 1;
    maxDifficulty = 1;
    currentZoneIndex = 0; // Reset zone
   
   // 🚨 ADD THESE 3 LINES:
    lastSpawn = 0; // Force immediate fresh spawn timing
    lastPowerupSpawn = 0;
    lastDangerSpawn = 0;
    // CRITICAL: Clear all leftover speed flags from previous game
    animals.forEach(a => {
        delete a.baseSpeed;
        delete a.baseVx;
    });
    dangerItems.forEach(d => {
        delete d.baseSpeed;
    });
    initAudio();
    initAudio();
    console.log("START GAME CALLED!");
    resetGameTracker();
    totalPlays++;
    localStorage.setItem('totalPlays', totalPlays);
  
    // Hide screens
    document.getElementById('overlay').classList.add('hidden');
    document.getElementById('statsScreen').classList.add('hidden');
    document.getElementById('leaderboardScreen').classList.add('hidden');
  
    // Reset game state
    gameRunning = true;
    paused = false;
    score = 0;
    lives = 3;
    combo = 0;
    streak = 0;
    maxStreak = 0;
    difficulty = 1;
    maxDifficulty = 1;
    slowMoActive = false;
    powerupsCaught = 0;
  
    // Reset arrays (only once!)
    animals = [];
    powerupNumbers = [];
    dangerItems = [];
    particles = [];
    rescued = {};
  
    // Reset player position
    player.x = gameWidth / 2 - 40;
  
    // Set initial zone
    currentZoneIndex = 0;
    const initialZone = progressionZones[0];
    const canvas = document.getElementById('gameCanvas');
    canvas.style.background = initialZone.background;
    document.getElementById('diffLevel').style.color = initialZone.color;
    createBackgroundElements(initialZone.emojiZone);
  
    // Reset spawn timers (only once!)
    lastSpawn = performance.now() + 2000;
    lastPowerupSpawn = performance.now() + 12000;
    lastDangerSpawn = performance.now() + 10000;
  
    // Show zone transition
    showZoneTransition(initialZone.name);
  
    // Update UI
    updateScore();
    updateStreak();
    updateStreakReward();
    updateLives();
    updateDifficultyDisplay();
  
    // Show pause button
    document.getElementById('pauseButton').style.display = 'flex';
  
    // Start game loop (ONLY ONCE!)
    animationFrameId = requestAnimationFrame(gameLoop);
}
        function endGame() {
            gameRunning = false;
            slowMoActive = false;
            document.getElementById('slowmoOverlay').classList.remove('active');
            document.getElementById('pauseButton').style.display = 'none';
            const gameOverAnim = document.createElement('div');
            gameOverAnim.className = 'game-over-animation';
            gameOverAnim.innerHTML = '<div class="game-over-text">GAME OVER</div>';
            document.body.appendChild(gameOverAnim);
            const total = Object.values(rescued).reduce((a, b) => a + b, 0);
            totalAnimalsCaught += total;
            totalPointsEarned += score;
            // totalPowerupsCaught += powerupsCaught;
            if(maxDifficulty > highestLevelReached) {
                highestLevelReached = maxDifficulty;
                localStorage.setItem('highestLevelReached', highestLevelReached);
            }
            localStorage.setItem('totalAnimalsCaught', totalAnimalsCaught);
            localStorage.setItem('totalPointsEarned', totalPointsEarned);
            // localStorage.setItem('totalPowerupsCaught', totalPowerupsCaught);
            localStorage.setItem('animalCounts', JSON.stringify(animalCounts));
            setTimeout(() => {
                gameOverAnim.remove();
                const gameOverScreen = document.getElementById('gameOverScreen');
                gameOverScreen.classList.remove('hidden');
                document.getElementById('finalScore').textContent = score;
                document.getElementById('stats').textContent = `${total} animals rescued`;
                document.getElementById('streakStats').textContent = `Best Streak: ${maxStreak} 🔥`;
                document.getElementById('diffStats').textContent = `Reached Level: ${maxDifficulty}`;
                // document.getElementById('powerupStats').textContent = `6️⃣7️⃣ Caught: ${powerupsCaught}`;
                document.getElementById('premiumStats').textContent = `⭐ Premium: ${totalPremiumsCaught} (${premiumSpeciesCaught.length}/16 species)`;
                const savedName = localStorage.getItem('playerName') || '';
                document.getElementById('playerNameInput').value = savedName;
                const newHigh = score > highScore;
                if(newHigh) {
                highScore = score;
                localStorage.setItem('zooKeeperHighScore', highScore);
                document.getElementById('newHighScore').classList.remove('hidden');
                document.getElementById('gameOverTitle').textContent = '🏆 NEW RECORD! 🏆';
            
                // NEW: Epic celebration for high score
                celebrateAchievement('highscore');
            
                achievementSound();
                setTimeout(bigWinSound, 500);
                    updateMainMenuHighScore();
                } else {
    document.getElementById('newHighScore').classList.add('hidden');
 
    // ✅ DYNAMIC TITLE based on score
    let gameOverTitle = 'Game Over!';
    if (score === 0) {
        gameOverTitle = 'Oops! Try Again!';
    } else if (score < 100) {
        gameOverTitle = 'Good Try!';
    } else if (score < 500) {
        gameOverTitle = 'Nice Run!';
    } else if (score < 1000) {
        gameOverTitle = 'Great Job!';
    } else if (score < 2000) {
        gameOverTitle = 'Amazing Run!';
    } else if (score < 5000) {
        gameOverTitle = 'Incredible!';
    } else {
        gameOverTitle = 'LEGENDARY! 🔥';
    }
    document.getElementById('gameOverTitle').textContent = gameOverTitle;
 
    const diff = highScore - score;
    const urgeEl = document.getElementById('urgePlayAgain');
    if(diff <= 50) {
        urgeEl.textContent = `SO CLOSE! Only ${diff} points away! 🔥 One more try!`;
        urgeEl.classList.remove('hidden');
        document.getElementById('restartBtn').textContent = 'BEAT IT NOW! 🎯';
    } else if(diff <= 150) {
        urgeEl.textContent = `You can do better! ${diff} points to beat! 💪`;
        urgeEl.classList.remove('hidden');
        document.getElementById('restartBtn').textContent = 'Try Again! 🚀';
    } else {
        urgeEl.classList.add('hidden');
        document.getElementById('restartBtn').textContent = 'Play Again 🎮';
    }
    if(diff < 100) {
        document.getElementById('almostMsg').textContent = `Almost there! Keep going! 🎯`;
    } else {
        document.getElementById('almostMsg').textContent = '';
    }
}
                if(maxStreak > bestStreak) {
                    bestStreak = maxStreak;
                    localStorage.setItem('bestStreak', bestStreak);
                }
              // Badge message based on performance
                           let msg = "Keep Trying!"; // Default for low scores
            if (maxDifficulty >= 100) msg = "Master!";
            else if (maxDifficulty >= 80) msg = "Expert!";
            else if (maxDifficulty >= 50) msg = "Skilled!";
            else if (maxDifficulty >= 40) msg = "Great Work!";
            else if (score >= 10000) msg = "Nice Run!";
            else if (score >= 5000) msg = "Good Start!";
            else if (score >= 500) msg = "Not Bad!";
            else if (score === 0) msg = "Try Again!";
            document.getElementById("badge").textContent = msg;
                document.getElementById('badge').textContent = msg;
            }, 1500);
        }
        function restart() {
            document.getElementById('gameOverScreen').classList.add('hidden');
            startGame();
        }
        document.getElementById('startBtn').addEventListener('click', startGame);
        document.getElementById('restartBtn').addEventListener('click', restart);
        document.getElementById('statsBtn').addEventListener('click', showStats);
        document.getElementById('viewStatsBtn').addEventListener('click', () => {
            document.getElementById('gameOverScreen').classList.add('hidden');
            showStats();
        });
        document.getElementById('closeStatsBtn').addEventListener('click', () => {
            document.getElementById('statsScreen').classList.add('hidden');
            document.getElementById('overlay').classList.remove('hidden');
            updateMainMenuHighScore();
        });
        document.getElementById('leaderboardBtn').addEventListener('click', () => {
            document.getElementById('overlay').classList.add('hidden');
            document.getElementById('leaderboardScreen').classList.remove('hidden');
            loadLeaderboard();
        });
        document.getElementById('closeLeaderboardBtn').addEventListener('click', () => {
            document.getElementById('leaderboardScreen').classList.add('hidden');
            document.getElementById('overlay').classList.remove('hidden');
        });
        document.getElementById('submitScoreBtn').addEventListener('click', () => {
            const playerName = document.getElementById('playerNameInput').value;
            submitScoreToLeaderboard(playerName, score);
        });
    
            // 2. ADD THESE NEW LISTENERS (replace old touchmove/mousemove)
            canvas.addEventListener('touchstart', handlePointerDown, { passive: false });
            canvas.addEventListener('mousedown', handlePointerDown);
            function handlePointerDown(e) {
                e.preventDefault();
                const rect = canvas.getBoundingClientRect();
                const x = (e.type === 'touchstart' ? e.touches[0].clientX : e.clientX) - rect.left;
                const basketCenterX = player.x + 40; // Basket center
                const dist = Math.abs(x - basketCenterX);
            
                // Drag starts ONLY if tap within 40px of basket center
                if (dist <= BASKET_RADIUS) {
                    isDragging = true;
                }
            }
            // 3. NEW touchmove (drag-only)
            canvas.addEventListener('touchmove', (e) => {
                if (!gameRunning || !isDragging) return;
                e.preventDefault();
                const rect = canvas.getBoundingClientRect();
                player.x = Math.max(0, Math.min(gameWidth - 80, e.touches[0].clientX - rect.left - 40));
            }, { passive: false });
            // 4. NEW mousemove (drag-only)
            canvas.addEventListener('mousemove', (e) => {
                if (!gameRunning || !isDragging) return;
                const rect = canvas.getBoundingClientRect();
                player.x = Math.max(0, Math.min(gameWidth - 80, e.clientX - rect.left - 40));
            });
            // 5. ADD drag-end (stops movement)
            canvas.addEventListener('touchend', () => { isDragging = false; });
            canvas.addEventListener('mouseup', () => { isDragging = false; });
            document.addEventListener('touchend', () => { isDragging = false; });
            document.addEventListener('mouseup', () => { isDragging = false; });
        document.addEventListener('keydown', (e) => {
            if (!gameRunning) return;
            if (e.key === 'ArrowLeft') player.x = Math.max(0, player.x - 22);
            if (e.key === 'ArrowRight') player.x = Math.min(gameWidth - 80, player.x + 22);
        });
        // Pause button functionality
document.getElementById('pauseButton').addEventListener('click', () => {
    if (!gameRunning) return; // Don't allow pausing if game isn't running
    paused = true;
    document.getElementById('pauseOverlay').classList.remove('hidden');
    document.getElementById('pauseButton').style.display = 'none'; // Hide pause button when paused
});
// Resume button
document.getElementById('resumeButton').addEventListener('click', () => {
    paused = false;
    document.getElementById('pauseOverlay').classList.add('hidden');
    document.getElementById('pauseButton').style.display = 'flex'; // Show pause button again
    // Resume the game loop
    if (gameRunning && !animationFrameId) {
        requestAnimationFrame(gameLoop);
    }
});
// Quit button (returns to main menu)
document.getElementById('quitButton').addEventListener('click', () => {
    paused = false;
    gameRunning = false;
    document.getElementById('pauseOverlay').classList.add('hidden');
    document.getElementById('pauseButton').style.display = 'flex';
    document.getElementById('overlay').classList.remove('hidden');
    // Cancel any ongoing animation frame
    if (animationFrameId) {
        cancelAnimationFrame(animationFrameId);
        animationFrameId = null;
    }
});
/// Auto-pause when user switches apps, gets a call, or minimizes browser
// Auto-pause when user switches apps, gets a call, or minimizes browser
document.addEventListener('visibilitychange', () => {
    if (document.hidden) {
        // Page is hidden (phone call, app switch, etc.)
        if (gameRunning && !paused) {
            paused = true;
            const overlay = document.getElementById('pauseOverlay');
            overlay.classList.remove('hidden');
            overlay.style.opacity = '1';
            document.getElementById('pauseButton').style.display = 'none';
        }
    } else {
        // Page is visible again
        if (gameRunning && paused) {
            // Ensure pause overlay is visible when returning
            const overlay = document.getElementById('pauseOverlay');
            overlay.classList.remove('hidden');
            overlay.style.opacity = '1';
            document.getElementById('pauseButton').style.display = 'none';
        }
    }
});
// Also handle when window loses focus
window.addEventListener('blur', () => {
    if (gameRunning && !paused) {
        paused = true;
        const overlay = document.getElementById('pauseOverlay');
        overlay.classList.remove('hidden');
        overlay.style.opacity = '1';
        document.getElementById('pauseButton').style.display = 'none';
    }
});
// When window gains focus, ensure pause screen shows if paused
window.addEventListener('focus', () => {
    if (gameRunning && paused) {
        const overlay = document.getElementById('pauseOverlay');
        overlay.classList.remove('hidden');
        overlay.style.opacity = '1';
        document.getElementById('pauseButton').style.display = 'none';
    }
});
// Optional: You could also auto-resume when they come back, but it's safer to keep it paused
// window.addEventListener('focus', () => {
// // Optionally auto-resume here if you want
// });
// Pause button functionality
document.getElementById('pauseButton').addEventListener('click', () => {
    if (!gameRunning) return;
    paused = true;
    const overlay = document.getElementById('pauseOverlay');
    overlay.classList.remove('hidden');
    document.getElementById('pauseButton').style.display = 'none';
    // Add a small delay for the animation to look smooth
    setTimeout(() => overlay.style.opacity = '1', 10);
});
// Resume button
document.getElementById('resumeButton').addEventListener('click', () => {
    const overlay = document.getElementById('pauseOverlay');
    overlay.style.opacity = '0';
    setTimeout(() => {
        paused = false;
        overlay.classList.add('hidden');
        document.getElementById('pauseButton').style.display = 'flex';
    
        if (gameRunning && !animationFrameId) {
            requestAnimationFrame(gameLoop);
        }
    }, 300); // Wait for fade out animation
});
// Quit button
document.getElementById('quitButton').addEventListener('click', () => {
    const overlay = document.getElementById('pauseOverlay');
    overlay.style.opacity = '0';
    setTimeout(() => {
        paused = false;
        gameRunning = false;
        overlay.classList.add('hidden');
        document.getElementById('pauseButton').style.display = 'flex';
        document.getElementById('overlay').classList.remove('hidden');
    
        if (animationFrameId) {
            cancelAnimationFrame(animationFrameId);
            animationFrameId = null;
        }
    }, 300);
});
// ================================
// ZOO KEEPER REAL IAP CODE
// ================================
// Real IAP initialization - runs automatically on app start
async function initIAP() {
  if (typeof window.Capacitor === 'undefined') {
    console.log('🧪 Browser: IAP skipped (expected)');
    return;
  }
  try {
    const NativePurchases = window.Capacitor.Plugins.NativePurchases;
    await NativePurchases.initialize();
    console.log('✅ IAP initialized successfully');
    // Check for premium product (logs when dev account ready)
    const { products } = await NativePurchases.getProducts({
      productIdentifiers: ['com.alstarian.zookeeper.premiumanimals'],
      productType: 'INAPP'
    });
    if (products && products.length > 0) {
      console.log('✅ Premium product ready:', products[0].identifier);
    }
  } catch (e) {
    console.log('IAP init (normal without dev account):', e.message);
  }
}
// Buy Premium Animals button
async function buyPremiumAnimals() {
  if (premiumUnlocked) {
    alert('✅ Premium Animals already unlocked!');
    // Update button display
    updatePremiumButton();
    return;
  }
  try {
    const NativePurchases = window.Capacitor.Plugins.NativePurchases;
    const result = await NativePurchases.purchaseProduct({
      productIdentifier: 'com.alstarian.zookeeper.premiumanimals',
      productType: 'INAPP'
    });
    // Success! Unlock premium forever
    premiumUnlocked = true
    localStorage.setItem('premiumUnlocked', 'true');
    alert('🎉 PREMIUM ANIMALS UNLOCKED!\n\n16 rare species now available in ALL zones:\n🦄 Unicorn • 🐺 Arctic Wolf\n🐒 Golden Monkey • 🐉 Dragon\n🦅 Golden Eagle • 🦚 Macaw\n🐋 Whale • 🦈 Shark\nand 8 more!'); // ← CHANGE: 14 to 16
    // Celebrate!
    throwConfetti(100);
    showAchievement('🦄', 'Premium Unlocked!', '16 rare animals added!');
    updatePremiumButton();
  } catch (e) {
    if (e.message && (e.message.includes('cancelled') || e.message.includes('user cancelled'))) {
      console.log('User cancelled purchase');
    } else {
      alert('Purchase unavailable. Please try again or contact support.');
    }
  }
}
// Restore Purchases button (REQUIRED by Apple)
async function restorePurchases() {
  try {
    const NativePurchases = window.Capacitor.Plugins.NativePurchases;
    await NativePurchases.restorePurchases();
    alert('✅ Purchases restored!\n\nPremium Animals will be unlocked if previously purchased.');
    // Check if premium was restored
    setTimeout(() => {
      if (premiumUnlocked) {
        alert('🎉 Premium Animals restored from previous purchase!');
      }
    }, 1000);
  } catch (e) {
    alert('Restore complete. No previous purchases found.');
  }
}
// Auto-start IAP when app loads
initIAP();
        // Tab Switching Logic
        document.querySelectorAll('.tab-button').forEach(button => {
            button.addEventListener('click', () => {
                document.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active'));
                button.classList.add('active');
                document.querySelectorAll('.animal-list').forEach(list => list.classList.remove('active'));
                document.getElementById(button.dataset.tab + '-list').classList.add('active');
            });
        });
window.addEventListener('resize', function() {
    // ONLY stop audio if game is actually running
    if(gameRunning) {
        document.querySelectorAll('audio').forEach(audio => {
            audio.pause();
            audio.currentTime = 0;
        });
    }
   
    if (window.innerWidth > window.innerHeight) {
        // Landscape - stop game completely
        if (animationFrameId) {
            cancelAnimationFrame(animationFrameId);
            animationFrameId = null;
        }
    }
});
// FIX ROTATION AUDIO BUG
window.addEventListener('resize', function() {
    document.querySelectorAll('audio').forEach(audio => {
        audio.pause();
        audio.currentTime = 0;
    });
});
    </script>
 
<!-- Zone Transition Modal -->
<div id="zoneTransitionModal" class="hidden">
    <div class="zone-modal-content">
        <h2 id="zoneModalTitle">Entering Zone</h2>
        <div id="zoneModalEmoji" class="zone-emoji">🌍</div>
        <p class="zone-subtitle">Get ready!</p>
    </div>
</div>
</body>
</html>
